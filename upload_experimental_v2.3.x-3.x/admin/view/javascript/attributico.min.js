$.ui.fancytree._FancytreeNodeClass.prototype.getParentByKey=function(key){var node=this;if(null!=(key=null==key?null:""+key)&&key!==this.key)for(;node.key.indexOf(key)&&!node.isRootNode();)node=node.getParent();return node.isRootNode()?null:node},$.ui.fancytree._FancytreeNodeClass.prototype.findUnselectedSibling=function(){for(var siblingNode=this.getNextSibling()||this.getPrevSibling()||this.getParent();siblingNode.isSelected()&&!siblingNode.isRootNode();)siblingNode=siblingNode.getPrevSibling()||siblingNode.getParent();return siblingNode},$.ui.fancytree._FancytreeNodeClass.prototype.getLanguageId=function(){var selector=this.tree.$div.context.id,lng_id;return parseInt(selector.replace(/\D+/gi,""))},$.ui.fancytree._FancytreeNodeClass.prototype.permission=function(actions){let permission=!1;for(let i=0;i<actions.length;i++)permission=permission||!this.key.indexOf(actions[i])&&!this.unselectable;return permission};class ContextmenuCommand{constructor(ui){this.ui=ui,this.node=$.ui.fancytree.getNode(ui.target),this.tree=$.ui.fancytree.getTree(ui.target),this.selector=this.tree.$div.context.id,this.lng_id=parseInt(this.selector.replace(/\D+/gi,""))}execute(){switch(this.ui.cmd){case"expande":case"collapse":this.tree.visit(function(node){node.setExpanded(!node.isExpanded())});break;case"options":$("#options_"+this.selector).dialog("open");break;case"rename":this.node.editStart();break;case"remove":if(!confirm(textConfirm))break;this.remove();break;case"addChild":1!==this.node.getLevel()&&this.addChild();break;case"addSibling":this.addSibling();break;case"copy":copyPaste(this.ui.cmd,this.node);break;case"paste":copyPaste(this.ui.cmd,this.node),deSelectNodes(this.node);break;default:alert("Todo: appply action '"+this.ui.cmd+"' to node "+this.node)}}remove(){deleteAttribute(this.node)}addChild(){addAttribute(this.node,"attribute",this.lng_id)}addSibling(){addAttribute(this.node,"group",this.lng_id)}}class ContextmenuCommandCategory extends ContextmenuCommand{remove(){deleteAttributesFromCategory(this.node)}addChild(){this.tree.getRootNode().getFirstChild().editCreateNode("child")}}class ContextmenuCommandDuty extends ContextmenuCommand{remove(){deleteDuty(this.node)}}class KeydownCommand{constructor(event,data){this.e=event,this.node=data.node,this.tree=data.tree,this.selector=this.tree.$div.context.id,this.lng_id=parseInt(this.selector.replace(/\D+/gi,"")),this.access={remove:!0,addChild:!0,addSibling:!0,copy:!0,paste:!0}}set permissions(newPermissions){this.access=newPermissions}execute(){switch(this.e.which){case 68:this.e.altKey&&(console.log("Debug mode: "),$.ajax({data:{user_token:user_token,token:token},url:"index.php?route="+extension+"module/attributico/debugSwitch",success:function(message){console.log(message)}}));break;case 66:this.e.ctrlKey&&this.tree.visit(function(node){node.setExpanded(!node.isExpanded())});break;case 46:this.access.remove&&confirm(textConfirm)&&this.remove();break;case 77:this.access.addSibling&&this.e.ctrlKey&&this.addSibling();break;case 81:this.access.addChild&&this.e.ctrlKey&&this.addChild();break;case 67:if(this.access.copy&&this.e.ctrlKey)return copyPaste("copy",this.node),!1;break;case 86:if(this.access.paste&&this.e.ctrlKey)return copyPaste("paste",this.node),deSelectNodes(this.node),!1}}remove(){deleteAttribute(this.node)}addChild(){addAttribute(this.node,"attribute",this.lng_id)}addSibling(){addAttribute(this.node,"group",this.lng_id)}}class KeydownCommandCategory extends KeydownCommand{remove(){deleteAttributesFromCategory(this.node)}addChild(){this.tree.getRootNode().getFirstChild().editCreateNode("child")}}class KeydownCommandDuty extends KeydownCommand{remove(){deleteDuty(this.node)}}class Filter{constructor(tab,tree,lng_id){this.data={tab:tab,tree:tree,lng_id:lng_id},this.input=$("input[name="+this.data.tab+"_search"+this.data.lng_id+"]"),this.btnSearch=$("button#"+this.data.tab+"_btnSearch"+this.data.lng_id),this.btnResetSearch=$("button#"+this.data.tab+"_btnResetSearch"+this.data.lng_id),this.checkbox=$("div#"+this.data.tab+"_filter"+this.data.lng_id+" input:checkbox"),this.autoComplete=$("input#fs"+this.data.tab+"_autoComplete"+this.data.lng_id)}attachEvents(){this.input.keyup(this.data,this.search).focus(),this.btnSearch.click(this.data,this.search),this.checkbox.change(this.data,this.changeSettings),this.btnResetSearch.click(this.data,this.clear).attr("disabled",!0),this.btnSearch.attr("disabled",this.autoComplete.is(":checked")),$("a[id ^=f_"+this.data.tab+this.data.lng_id+"]").click(this.data,this.action)}clear(e){e.data.tree.isFilterActive()&&(e.data.tree.clearFilter(),$("input[name *= "+e.data.tab+"_search"+e.data.lng_id+"]").val(""),$("span[id *= "+e.data.tab+"_matches"+e.data.lng_id+"]").text(""),$("[id ^=loadImg]").hide())}changeSettings(e){let id=$(this).attr("id"),flag=$(this).is(":checked");switch(id){case"fs_"+e.data.tab+"_autoExpand"+e.data.lng_id:case"fs_"+e.data.tab+"_regex"+e.data.lng_id:case"fs_"+e.data.tab+"_leavesOnly"+e.data.lng_id:case"fs_"+e.data.tab+"_attributesOnly"+e.data.lng_id:break;case"fs_"+e.data.tab+"_autoComplete"+e.data.lng_id:$("button#"+e.data.tab+"_btnSearch"+e.data.lng_id).attr("disabled",$(this).is(":checked"));break;case"fs_"+e.data.tab+"_hideMode"+e.data.lng_id:e.data.tree.options.filter.mode=flag?"hide":"dimm";break;case"fs_"+e.data.tab+"_counter"+e.data.lng_id:case"fs_"+e.data.tab+"_fuzzy"+e.data.lng_id:case"fs_"+e.data.tab+"_hideExpandedCounter"+e.data.lng_id:case"fs_"+e.data.tab+"_highlight"+e.data.lng_id:e.data.tree.options.filter[id.replace(/\d/g,"")]=flag}e.data.tree.clearFilter(),$("input[name="+e.data.tab+"_search"+e.data.lng_id+"]").trigger("keyup")}search(e){let tab=e.data.tab,lng_id=e.data.lng_id,tree=e.data.tree,n=0,opts={autoExpand:$("#fs_"+tab+"_autoExpand"+lng_id).is(":checked"),leavesOnly:$("#fs_"+tab+"_leavesOnly"+lng_id).is(":checked")},attributesOnly=$("#fs_"+tab+"_attributesOnly"+lng_id).is(":checked"),match=$("input[name="+tab+"_search"+lng_id+"]").val();e&&e.which===$.ui.keyCode.ESCAPE||""===$.trim(match)?$("button#"+tab+"_btnResetSearch"+lng_id).click():($("#fs_"+tab+"_autoComplete"+lng_id).is(":checked")||"keyup"!==e.type)&&(attributesOnly||tree.options.source.data.isPending||(tree.visit(function(node){node.isLazy()&&node.load(!0)}),tree.options.source.data.isPending=!0),setTimeout(()=>{$("#fs_"+tab+"_regex"+lng_id).is(":checked")?(n=tree.filterNodes(function(node){return new RegExp(match,"i").test(node.title)},opts),$("span#"+tab+"_matches"+lng_id).text("("+n+")")):(n=tree.filterNodes(match,opts),$("span#"+tab+"_matches"+lng_id).text("("+n+")"))},600),$("button#"+tab+"_btnResetSearch"+lng_id).attr("disabled",!1),$("span#"+tab+"_matches"+lng_id).text("("+n+")"))}action(e){let tab=e.data.tab,lng_id=e.data.lng_id,btnSearch=$("button#"+tab+"_btnSearch"+lng_id),btnResetSearch=$("button#"+tab+"_btnResetSearch"+lng_id),regex=$("div#"+tab+"_searchmode"+lng_id+" input#fs_"+tab+"_regex"+lng_id+":checkbox"),input=$("input[name="+tab+"_search"+lng_id+"]");switch(regex.prop({checked:!0}),e.target.id){case"f_"+tab+lng_id+"_empty":input.val("^s*$"),btnSearch.trigger("click");break;case"f_"+tab+lng_id+"_digital":input.val("[0-9]"),btnSearch.trigger("click");break;case"f_"+tab+lng_id+"_html":input.val("<[^>]+>"),btnSearch.trigger("click");break;case"f_"+tab+lng_id+"_default":regex.prop({checked:!1}),btnResetSearch.trigger("click")}return!1}}function bildFilter(){let id=$(this).attr("id"),lng_id=parseInt(id.replace(/\D+/gi,"")),tab=id.split("_")[0],checkbox=filterItems[lng_id].checkbox,spancheckbox=filterItems[lng_id].spancheckbox,dropdown=filterItems[lng_id].dropdown,widget=tab+"_filterwidget"+lng_id,hideFilter="fs_"+tab+"_hideFilter"+lng_id;$("<label>",{class:"checkbox-inline pull-right clearfix",for:hideFilter,append:$("<input>",{type:"checkbox",class:"hide",name:hideFilter,id:hideFilter,checked:!!($.inArray(hideFilter,FILTERSETTINGS)+1),"data-toggle":"collapse","data-target":"#"+widget}).add($("<i>",{class:"fa fa-angle-double-down fa-lg","aria-hidden":"true"}))}).appendTo(this);let open=$.inArray(hideFilter,FILTERSETTINGS)+1?"in":"",form=$("<div>",{class:"form-group form-inline collapse "+open,id:widget});form.appendTo(this);let search=tab+"_search"+lng_id,btnSearch=tab+"_btnSearch"+lng_id,btnResetSearch=tab+"_btnResetSearch"+lng_id;$("<label>",{for:search,text:filterItems[lng_id].title,style:"margin-left:1px;"}).appendTo(form),$("<input>",{type:"text",name:search,placeholder:"Filter...",class:"form-control",id:search,style:"margin-left:1px;"}).appendTo(form),$("<button>",{id:btnResetSearch,type:"button",class:"btn btn-default",append:$("<i>",{class:"fa fa-times","aria-hidden":"true"}),style:"margin-left:1px;"}).appendTo(form),$("<button>",{id:btnSearch,type:"button",class:"btn btn-default",append:$("<i>",{class:"fa fa-search","aria-hidden":"true"}),style:"margin-left:1px;"}).appendTo(form);let dropdownmenu=$("<div>",{class:"btn-group dropdown-events"});dropdownmenu.appendTo(form),$("<button>",{type:"button",class:"btn btn-default dropdown-toggle","data-toggle":"dropdown","aria-haspopup":"true","aria-expanded":"false",text:filterItems[lng_id].button,append:$("<span>",{class:"caret"}),style:"margin-left:1px;"}).appendTo(dropdownmenu);let ul=$("<ul>",{class:"dropdown-menu"});for(var key in ul.appendTo(dropdownmenu),dropdown){let li=$("<li>").appendTo(ul);$("<a>",{id:"f_"+tab+lng_id+"_"+key,href:"#",text:dropdown[key]}).appendTo(li)}for(var key in $("<span>",{id:tab+"_matches"+lng_id,class:"badge"}).appendTo(form),checkbox){let itemId="fs_"+tab+"_"+key+lng_id;$("<input>",{type:"checkbox",name:itemId,id:itemId,checked:!!($.inArray(itemId,FILTERSETTINGS)+1),style:"margin-left:1rem;"}).appendTo(form),$("<label>",{for:itemId,style:"padding-top:0px; margin-left:1px; font-weight:normal;",text:checkbox[key]}).appendTo(form)}$("<div>",{class:"ajax-loader",append:$("<img>",{src:"view/javascript/fancytree/skin-win7/loading.gif",id:"loadImg"+lng_id,style:"z-index:1000; display:none;"})}).appendTo(form);let span=$("<div>",{id:tab+"_searchmode"+lng_id,style:"margin-top:1em;"});for(var key in span.appendTo(form),spancheckbox){let spanId="fs_"+tab+"_"+key+lng_id;$("<input>",{type:"checkbox",name:spanId,id:spanId,checked:!!($.inArray(spanId,FILTERSETTINGS)+1),style:"margin-left:1rem;"}).appendTo(span),$("<label>",{for:spanId,style:"padding-top:0px; margin-left:1px; font-weight:normal;",text:spancheckbox[key]}).appendTo(span)}}function ClearFilter(tree){tree.isFilterActive()&&(tree.clearFilter(),$('input[name *= "search"]').val(""),$('span[id *= "matches"]').text(""),$("[id ^=loadImg]").hide())}function reactivateCategory(){let node=0!==arguments.length?arguments[0]:null;CATEGORY_TREE.each(function(indx,element){const tree=$("#"+element.id).fancytree("getTree");let activeNode=null!==node?node:tree.getActiveNode();null!=activeNode&&(tree.getNodeByKey(activeNode.key).setActive(!1),tree.getNodeByKey(activeNode.key).setActive(!0))})}function reloadAttribute(){if(0==arguments.length)ATTRIBUTE_SYNCRO_TREES.each(function(indx,element){const tree=$("#"+element.id).fancytree("getTree");let activeNode=tree.getActiveNode();ClearFilter(tree),tree.options.source.data.cache=$('input[name = "attributico_cache"]:checkbox').is(":checked"),tree.reload().done(function(){tree.options.source.data.isPending=!1,null!==activeNode&&tree.getNodeByKey(activeNode.key).setActive(!0)})});else{var node=arguments[0],self=arguments[1];ATTRIBUTE_SYNCRO_TREES.each(function(indx,element){var tree=$("#"+element.id).fancytree("getTree");tree.options.source.data.cache=$('input[name = "attributico_cache"]:checkbox').is(":checked"),(tree!==node.tree||self)&&(ClearFilter(tree),tree.reload().done(function(){tree.options.source.data.isPending=!1;var newnode=tree.getNodeByKey(node.key);newnode&&void 0!==newnode&&newnode.setActive()}))}),self||node.setActive()}}function getSelectedKeys(selNodes){var selKeys=[];return selNodes&&selNodes.forEach(function(node){selKeys.push(node.key)}),selKeys}function getSelectedTitles(selNodes){var selTitles=[];return selNodes&&selNodes.forEach(function(node){selTitles.push(node.title)}),selTitles}function deSelectNodes(node){selNodes&&selNodes.forEach(function(node){node.setSelected(!1)}),selNodes=null}function selectControl(data){return data.node.isTopLevel()?(data.node.setSelected(!1),!1):(data.node.tree.visit(function(node){data.node.getLevel()!==node.getLevel()&&node.setSelected(!1)}),!0)}function addAttribute(activeNode,activeKey,lng_id){for(var node=activeNode,parentLevel="attribute"===activeKey?2:1;node.getLevel()>parentLevel;)node=node.getParent();$.ajax({data:{user_token:user_token,token:token,key:node.key,name:"attribute"===activeKey?textNewAttribute:textNewGroup},url:"index.php?route="+extension+"module/attributico/addAttribute",success:function(new_id){node.editCreateNode("child",{title:"attribute"===activeKey?textNewAttribute[lng_id]:textNewGroup[lng_id],key:activeKey+"_"+new_id,folder:"group"===activeKey})}})}function deleteAttribute(node){let level=node.getLevel();if(2===level||3===level||5===level){var siblingNode=node.findUnselectedSibling();$.ajax({data:{user_token:user_token,token:token,keys:selNodes?getSelectedKeys(selNodes):[node.key],titles:selNodes?getSelectedTitles(selNodes):[node.title],language_id:node.getLanguageId()},url:"index.php?route="+extension+"module/attributico/deleteAttributes",success:function(){selNodes?$.each(selNodes,function(i,o){o.remove()}):node.remove(),reloadAttribute(siblingNode,5===level),selNodes=null}})}}function copyAttributes(targetNode){var node=targetNode.getParentByKey("group")||targetNode.getParentByKey("category");node.key.indexOf("group")+1&&$.ajax({data:{user_token:user_token,token:token,target:node.key,attributes:clipboardTitles},url:"index.php?route="+extension+"module/attributico/addAttributes",success:function(){reloadAttribute(targetNode,!0)}}),node.key.indexOf("category")+1&&$.ajax({data:{attributes:selNodes?getSelectedKeys(selNodes):[clipboardNodes[0][1].key],category_id:node.key,categories:selCategories?getSelectedKeys(selCategories):[node.key]},url:"index.php?route="+extension+"module/attributico/addCategoryAttributes&user_token="+user_token+"&token="+token,type:"POST",success:function(){reactivateCategory(node)}})}function deleteAttributesFromCategory(node){var category_id=node.getParent().key;$.ajax({data:{attributes:selNodes?getSelectedKeys(selNodes):[node.key],category_id:category_id,categories:selCategories?getSelectedKeys(selCategories):[category_id]},url:"index.php?route="+extension+"module/attributico/deleteAttributesFromCategory&user_token="+user_token+"&token="+token,type:"POST",success:function(){reactivateCategory(),reloadAttribute(node,!0)}}),selNodes=null}function addAttributeToCategory(targetnode,data,remove){$.ajax({data:{attributes:selNodes?getSelectedKeys(selNodes):[data.otherNode.key],category_id:targetnode.key,categories:selCategories?getSelectedKeys(selCategories):[targetnode.key]},url:"index.php?route="+extension+"module/attributico/addCategoryAttributes&user_token="+user_token+"&token="+token,type:"POST"}).done(function(){remove?deleteAttributesFromCategory(data.otherNode):(deSelectNodes(data.otherNode),data.otherNode.tree.visit(function(node){node.isLazy()&&node.load(!0)}),reactivateCategory(targetnode),reloadAttribute(data.otherNode,!1))})}function deleteDuty(node){$.ajax({data:{user_token:user_token,token:token,key:node.key,language_id:node.getLanguageId(),name:""},url:"index.php?route="+extension+"module/attributico/editAttribute",success:function(){reloadAttribute(node,!0)}})}var clipboardNodes=[],clipboardTitles=[],pasteMode=null;function copyPaste(action,targetNode){switch(action){case"cut":case"copy":pasteMode=action,selNodes?selNodes.forEach(function(node,i){clipboardNodes[i]=[],clipboardTitles[i]=[],ATTRIBUTE_GROUP_TREE.each(function(indx,element){var tree=$("#"+element.id).fancytree("getTree"),lng_id=parseInt(element.id.replace(/\D+/gi,""));clipboardNodes[i][lng_id]=tree.getNodeByKey(node.key),clipboardTitles[i][lng_id]=tree.getNodeByKey(node.key).title})}):(clipboardNodes[0]=[],clipboardTitles[0]=[],ATTRIBUTE_GROUP_TREE.each(function(indx,element){var tree=$("#"+element.id).fancytree("getTree"),lng_id=parseInt(element.id.replace(/\D+/gi,""));clipboardNodes[0][lng_id]=tree.getNodeByKey(targetNode.key),clipboardTitles[0][lng_id]=tree.getNodeByKey(targetNode.key).title}));break;case"paste":if(0==clipboardNodes.length){alert("Clipoard is empty.");break}"cut"==pasteMode?(copyAttributes(targetNode,clipboardTitles),clipboardNodes[indx].remove()):copyAttributes(targetNode,clipboardTitles),clipboardNodes=[],clipboardTitles=[],pasteMode=null;break;default:alert("Unhandled clipboard action '"+action+"'")}}function initTrees(){ATTRIBUTE_GROUP_TREE.each(function(indx,element){var lng_id=parseInt(element.id.replace(/\D+/gi,"")),currentTab="tab-attribute",attribute_group_tree=$("#attribute_group_tree"+lng_id),sortOrder=$('input[id = "sortOrder_attribute_group_tree'+lng_id+'"]:checkbox').is(":checked"),lazyLoad=$('input[id = "lazyLoad_attribute_group_tree'+lng_id+'"]:checkbox').is(":checked");attribute_group_tree.fancytree({autoCollapse:!0,autoScroll:!0,minExpandLevel:2,extensions:["edit","dnd","filter"],selectMode:2,checkbox:!1,quicksearch:!0,source:{data:{user_token:user_token,token:token,language_id:lng_id,sortOrder:sortOrder,lazyLoad:lazyLoad,tree:"1",isPending:!1},url:"index.php?route="+extension+"module/attributico/getAttributeGroupTree"},loadError:function(e,data){var error=data.error;error.status&&error.statusText?(data.message="Ajax error: "+data.message,data.details="Ajax error: "+error.statusText+", status code = "+error.status):(data.message="Custom error: "+data.message,data.details="An error occurred during loading: "+error),console.log(data),console.log(error.responseText)},lazyLoad:function(event,data){data.result={data:{user_token:user_token,token:token,key:data.node.key,language_id:lng_id},url:"index.php?route="+extension+"module/attributico/getLazyAttributeValues"}},edit:{triggerStart:["f2","shift+click","mac+enter"],inputCss:{minWidth:"18em"},beforeEdit:function(event,data){if(!data.node.permission(["group","attribute","template","value"]))return!1},edit:function(event,data){},beforeClose:function(event,data){},save:function(event,data){var parent=data.node.getParent();return $.ajax({data:{user_token:user_token,token:token,key:data.node.key,name:data.input.val(),language_id:lng_id,oldname:data.orgTitle},url:"index.php?route="+extension+"module/attributico/editAttribute"}).done(function(result){data.node.key.indexOf("template")+1?data.node.parent.isLazy()?parent.getNextSibling().load(!0).done(function(result){reloadAttribute(data.node,!1)}):reloadAttribute(data.node,!0):data.node.key.indexOf("value")+1?data.node.parent.isLazy()?parent.getPrevSibling().load(!0).done(function(result){parent.load(!0).done(function(result){(data.node.tree.getNodeByKey(data.node.key)||data.node.getPrevSibling()||data.node.getNextSibling()).setActive()})}).done(function(result){reloadAttribute(data.node,!1)}):reloadAttribute(data.node,!0):reloadAttribute(data.node,!1),data.node.setTitle(result.acceptedTitle)}).fail(function(result){data.node.setTitle(data.orgTitle)}).always(function(){$(data.node.span).removeClass("pending")}),!0},close:function(event,data){data.save&&$(data.node.span).addClass("pending")}},dnd:{autoExpandMS:600,focusOnClick:!0,preventVoidMoves:!0,preventRecursiveMoves:!1,dragStart:function(node,data){return!(data.node.isRootNode()||data.node.getLevel()>3)},dragEnter:function(targetNode,data){var targetLevel=targetNode.getLevel(),subjectLevel=data.otherNode.getLevel(),subjectNode=data.otherNode;return!(1===targetLevel||targetLevel>subjectLevel)&&(targetNode!==subjectNode.parent&&(!(targetNode.parent===subjectNode.parent&&!data.tree.options.source.data.sortOrder&&!data.originalEvent.ctrlKey)&&(targetLevel!==subjectLevel||data.originalEvent.ctrlKey?["over"]:["before","after"])))},dragDrop:function(targetNode,data){var subjectNode=data.otherNode,targetLevel=targetNode.getLevel(),subjectLevel=subjectNode.getLevel(),selfreload=!1,replace=targetNode.getParent()!==subjectNode.getParent(),merge=data.originalEvent.ctrlKey&&targetLevel===subjectLevel;merge&&!confirm(textConfirm)||(selNodes?$.each(selNodes,function(i,subjectNode){merge?subjectNode.remove():(subjectNode.moveTo(targetNode,data.hitMode),selfreload=!0)}):merge?subjectNode.remove():subjectNode.moveTo(targetNode,data.hitMode),merge?(url="index.php?route="+extension+"module/attributico/mergeAttributeGroup",selfreload=!0):replace?(url="index.php?route="+extension+"module/attributico/replaceAttributeGroup",selfreload=!1):url="index.php?route="+extension+"module/attributico/sortAttributeGroup",$.ajax({data:{user_token:user_token,token:token,subjects:selNodes?getSelectedKeys(selNodes):[subjectNode.key],group:targetNode.getParent().key,target:targetNode.key,direct:data.hitMode},url:url}).done(function(){reloadAttribute(subjectNode,selfreload),deSelectNodes(subjectNode)}))},draggable:{scroll:!0}},beforeSelect:function(event,data){if(!selectControl(data))return!1},select:function(event,data){selNodes=data.tree.getSelectedNodes()},click:function(event,data){event.ctrlKey?data.node.toggleSelected():deSelectNodes(data.node)},keydown:function(e,data){let command=new KeydownCommand(e,data);command.permissions={remove:data.node.permission(["group","attribute","template","value"]),addChild:!0,addSibling:!0,copy:data.node.permission(["attribute"]),paste:!0},command.execute()},filter:{autoApply:!0,counter:!0,fuzzy:!1,hideExpandedCounter:!0,highlight:!0,mode:"dimm"},init:function(event,data){let filter;new Filter(currentTab,data.tree,lng_id).attachEvents(),smartScroll.is(":checked")&&data.tree.$container.addClass("smart-scroll"),data.tree.$div.contextmenu({delegate:"span.fancytree-title",menu:contextmenu[lng_id],beforeOpen:function(event,ui){let node=$.ui.fancytree.getNode(ui.target);data.tree.$div.contextmenu("enableEntry","remove",node.permission(["group","attribute","template","value"])),data.tree.$div.contextmenu("enableEntry","rename",node.permission(["group","attribute","template","value"])),data.tree.$div.contextmenu("enableEntry","copy",!node.key.indexOf("attribute")),data.tree.$div.contextmenu("enableEntry","paste",!(0==clipboardNodes.length||node.getParent().isRootNode())),node.setActive()},select:function(event,ui){let command;new ContextmenuCommand(ui).execute()}})}})}),CATEGORY_TREE.each(function(indx,element){var lng_id=parseInt(element.id.replace(/\D+/gi,"")),category_tree=$("#category_tree"+lng_id),sortOrder=$('input[id = "sortOrder_category_tree'+lng_id+'"]:checkbox').is(":checked");category_tree.fancytree({autoCollapse:!0,autoScroll:!0,minExpandLevel:2,extensions:["dnd"],checkbox:!0,selectMode:$('input[id = "multiSelect_category_tree'+lng_id+'"]:checkbox').is(":checked")?3:2,source:{data:{user_token:user_token,token:token,language_id:lng_id,sortOrder:sortOrder},url:"index.php?route="+extension+"module/attributico/getCategoryTree"},activate:function(event,data){var tree=$("#category_attribute_tree"+lng_id).fancytree("getTree");currentCategory=data.node.key,tree.reload({data:{user_token:user_token,token:token,language_id:lng_id,category_id:currentCategory,sortOrder:$('input[id = "sortOrder_category_attribute_tree'+lng_id+'"]:checkbox').is(":checked"),tree:"4"},url:"index.php?route="+extension+"module/attributico/getCategoryAttributeTree"})},dnd:{autoExpandMS:400,focusOnClick:!1,preventVoidMoves:!0,preventRecursiveMoves:!0,dragStart:function(node,data){return!1},dragEnter:function(node,data){return data.otherNode.getParent().key!==node.key},dragDrop:function(node,data){addAttributeToCategory(node,data,data.otherNode.tree.$div.context.id.indexOf("attribute_tree"))}},select:function(event,data){selCategories=data.tree.getSelectedNodes(),data.tree.options.autoCollapse=!1,data.node.setExpanded(!(data.node.expanded&&!selCategories.length))},keydown:function(e,data){let command=new KeydownCommand(e,data);command.permissions={remove:!1,addChild:!1,addSibling:!1,copy:!1,paste:!0},command.execute()},focusTree:function(e,data){data.tree.$container.focus()},init:function(event,data){smartScroll.is(":checked")&&data.tree.$container.addClass("smart-scroll"),data.tree.$div.contextmenu({delegate:"span.fancytree-title",menu:contextmenu[lng_id],beforeOpen:function(event,ui){let node=$.ui.fancytree.getNode(ui.target);data.tree.$div.contextmenu("enableEntry","remove",!1),data.tree.$div.contextmenu("enableEntry","rename",!1),data.tree.$div.contextmenu("enableEntry","addSibling",!1),data.tree.$div.contextmenu("enableEntry","addChild",!1),data.tree.$div.contextmenu("enableEntry","paste",!(0==clipboardNodes.length||node.getParent().isRootNode())),node.setActive()},select:function(event,ui){let command;new ContextmenuCommand(ui).execute()}})}})}),CATEGORY_ATTRIBUTE_TREE.each(function(indx,element){var lng_id=parseInt(element.id.replace(/\D+/gi,"")),category_attribute_tree=$("#category_attribute_tree"+lng_id),sortOrder=$('input[id = "sortOrder_category_attribute_tree'+lng_id+'"]:checkbox').is(":checked");category_attribute_tree.fancytree({autoCollapse:!0,autoScroll:!0,minExpandLevel:2,selectMode:2,extensions:["edit","dnd"],source:{data:{user_token:user_token,token:token,language_id:lng_id,category_id:currentCategory,sortOrder:sortOrder,tree:"4"},url:"index.php?route="+extension+"module/attributico/getCategoryAttributeTree"},loadError:function(e,data){var error=data.error;error.status&&error.statusText?(data.message="Ajax error: "+data.message,data.details="Ajax error: "+error.statusText+", status code = "+error.status):(data.message="Custom error: "+data.message,data.details="An error occurred during loading: "+error),console.log(data),console.log(error.responseText)},lazyLoad:function(event,data){data.result={data:{user_token:user_token,token:token,key:data.node.key,language_id:lng_id},url:"index.php?route="+extension+"module/attributico/getLazyAttributeValues"}},edit:{triggerStart:[],inputCss:{minWidth:"18em"},beforeEdit:function(event,data){if(!data.isNew)return!1},edit:function(event,data){data.input.dropmenu({source:function(request,response){$.ajax({data:{user_token:user_token,token:token,filter_name:encodeURIComponent(request),language_id:lng_id},url:"index.php?route="+extension+"module/attributico/autocomplete",dataType:"json",success:function(json){response($.map(json,function(item){return{category:item.attribute_group,label:item.name,value:item.attribute_id}}))}})},select:function(item){data.input.val(item.label),data.node.key="attribute_"+item.value}})},beforeClose:function(event,data){},save:function(event,data){return $.ajax({data:{attributes:[data.node.key],category_id:data.node.getParent().key,categories:selCategories?getSelectedKeys(selCategories):[data.node.getParent().key]},url:"index.php?route="+extension+"module/attributico/addCategoryAttributes&user_token="+user_token+"&token="+token,type:"POST"}).done(function(){$(data.node.span).removeClass("pending"),data.node.setTitle(data.node.title),reactivateCategory(data.node.getParent())}),!0},close:function(event,data){data.save&&$(data.node.span).addClass("pending")}},dnd:{autoExpandMS:400,focusOnClick:!1,preventVoidMoves:!0,preventRecursiveMoves:!0,dragStart:function(node,data){return!0},dragEnter:function(node,data){return node.tree!==data.otherNode.tree&&!(node.getLevel()>2)},dragDrop:function(node,data){addAttributeToCategory(node.getParent().isRootNode()?node:node.getParent(),data,!1)}},beforeSelect:function(event,data){if(!selectControl(data))return!1},select:function(event,data){selNodes=data.tree.getSelectedNodes()},click:function(event,data){event.ctrlKey?data.node.toggleSelected():deSelectNodes(data.node)},keydown:function(e,data){let command=new KeydownCommandCategory(e,data);command.permissions={remove:!data.node.key.indexOf("attribute"),addChild:!0,addSibling:!1,copy:!data.node.key.indexOf("attribute"),paste:!0},command.execute()},focusTree:function(e,data){data.tree.$container.focus()},init:function(event,data){smartScroll.is(":checked")&&data.tree.$container.addClass("smart-scroll"),data.tree.$div.contextmenu({delegate:"span.fancytree-title",menu:contextmenu[lng_id],beforeOpen:function(event,ui){let node=$.ui.fancytree.getNode(ui.target);data.tree.$div.contextmenu("enableEntry","remove",!node.key.indexOf("attribute")),data.tree.$div.contextmenu("enableEntry","rename",!1),data.tree.$div.contextmenu("enableEntry","addSibling",!1),data.tree.$div.contextmenu("enableEntry","copy",!node.key.indexOf("attribute")),data.tree.$div.contextmenu("enableEntry","paste",!(0==clipboardNodes.length)),node.setActive()},select:function(event,ui){let command;new ContextmenuCommandCategory(ui).execute()}})}})}),ATTRIBUTE_TREE.each(function(indx,element){var currentTab="tab-category",lng_id=parseInt(element.id.replace(/\D+/gi,"")),attribute_tree=$("#attribute_tree"+lng_id),sortOrder=$('input[id = "sortOrder_attribute_tree'+lng_id+'"]:checkbox').is(":checked"),lazyLoad=$('input[id = "lazyLoad_attribute_tree'+lng_id+'"]:checkbox').is(":checked");attribute_tree.fancytree({autoCollapse:!0,autoScroll:!0,minExpandLevel:2,extensions:["dnd","filter"],selectMode:2,checkbox:!1,quicksearch:!0,source:{data:{user_token:user_token,token:token,language_id:lng_id,sortOrder:sortOrder,lazyLoad:lazyLoad,isPending:!1,tree:"3"},url:"index.php?route="+extension+"module/attributico/getAttributeGroupTree"},loadError:function(e,data){var error=data.error;error.status&&error.statusText?(data.message="Ajax error: "+data.message,data.details="Ajax error: "+error.statusText+", status code = "+error.status):(data.message="Custom error: "+data.message,data.details="An error occurred during loading: "+error),console.log(data),console.log(error.responseText)},lazyLoad:function(event,data){data.result={data:{user_token:user_token,token:token,key:data.node.key,language_id:lng_id},url:"index.php?route="+extension+"module/attributico/getLazyAttributeValues"}},dnd:{autoExpandMS:800,focusOnClick:!0,preventVoidMoves:!0,preventRecursiveMoves:!0,dragStart:function(node,data){return 3===data.node.getLevel()},draggable:{revert:!0,cursorAt:{top:-5,left:-5},connectToFancytree:!0,appendTo:"body",scroll:!0}},beforeSelect:function(event,data){if(!selectControl(data))return!1},select:function(event,data){selNodes=data.tree.getSelectedNodes()},click:function(event,data){event.ctrlKey?data.node.toggleSelected():deSelectNodes(data.node)},keydown:function(e,data){let command=new KeydownCommand(e,data);command.permissions={remove:!1,addChild:!1,addSibling:!1,copy:!data.node.key.indexOf("attribute"),paste:!1},command.execute()},filter:{autoApply:!0,counter:!0,fuzzy:!1,hideExpandedCounter:!0,highlight:!0,mode:"dimm"},init:function(event,data){let filter;new Filter(currentTab,data.tree,lng_id).attachEvents(),smartScroll.is(":checked")&&data.tree.$container.addClass("smart-scroll"),data.tree.$div.contextmenu({delegate:"span.fancytree-title",menu:contextmenu[lng_id],beforeOpen:function(event,ui){let node=$.ui.fancytree.getNode(ui.target);data.tree.$div.contextmenu("enableEntry","remove",!1),data.tree.$div.contextmenu("enableEntry","rename",!1),data.tree.$div.contextmenu("enableEntry","addSibling",!1),data.tree.$div.contextmenu("enableEntry","addChild",!1),data.tree.$div.contextmenu("enableEntry","copy",!node.key.indexOf("attribute")),node.setActive()},select:function(event,ui){let command;new ContextmenuCommand(ui).execute()}})}})}),DUTY_ATTRIBUTE_TREE.each(function(indx,element){var lng_id=parseInt(element.id.replace(/\D+/gi,"")),duty_attribute_tree=$("#duty_attribute_tree"+lng_id),currentTab="tab-duty",sortOrder=$('input[id = "sortOrder_duty_attribute_tree'+lng_id+'"]:checkbox').is(":checked"),lazyLoad=$('input[id = "lazyLoad_duty_attribute_tree'+lng_id+'"]:checkbox').is(":checked");duty_attribute_tree.fancytree({autoCollapse:!0,autoScroll:!0,minExpandLevel:2,extensions:["edit","filter"],checkbox:!1,quicksearch:!0,source:{data:{user_token:user_token,token:token,language_id:lng_id,sortOrder:sortOrder,lazyLoad:lazyLoad,isPending:!1,tree:"2"},url:"index.php?route="+extension+"module/attributico/getAttributeGroupTree"},loadError:function(e,data){var error=data.error;error.status&&error.statusText?(data.message="Ajax error: "+data.message,data.details="Ajax error: "+error.statusText+", status code = "+error.status):(data.message="Custom error: "+data.message,data.details="An error occurred during loading: "+error),console.log(data),console.log(error.responseText)},lazyLoad:function(event,data){data.result={data:{user_token:user_token,token:token,key:data.node.key,language_id:lng_id},url:"index.php?route="+extension+"module/attributico/getLazyAttributeValues"}},edit:{triggerStart:["f2","shift+click","mac+enter"],inputCss:{minWidth:"18em"},beforeEdit:function(event,data){if(!data.node.permission(["group","attribute","duty"]))return!1},save:function(event,data){var parent=data.node.getParent();return $.ajax({data:{user_token:user_token,token:token,key:data.node.key,name:data.input.val(),language_id:lng_id,oldname:data.orgTitle},url:"index.php?route="+extension+"module/attributico/editAttribute"}).done(function(result){data.node.key.indexOf("template")+1?parent.getNextSibling().load(!0).done(function(result){reloadAttribute(data.node,!1)}):data.node.key.indexOf("value")+1?parent.getPrevSibling().load(!0).done(function(result){parent.load(!0).done(function(result){(data.node.tree.getNodeByKey(data.node.key)||data.node.getPrevSibling()||data.node.getNextSibling()).setActive()})}).done(function(result){reloadAttribute(data.node,!1)}):reloadAttribute(data.node,!1),data.node.setTitle(result.acceptedTitle)}).fail(function(result){data.node.setTitle(data.orgTitle)}).always(function(){$(data.node.span).removeClass("pending")}),!0},close:function(event,data){data.save&&$(data.node.span).addClass("pending")}},beforeSelect:function(event,data){return!1},keydown:function(e,data){let command=new KeydownCommandDuty(e,data);command.permissions={remove:data.node.permission(["duty"]),addChild:!1,addSibling:!1,copy:!1,paste:!1},command.execute()},filter:{autoApply:!0,counter:!0,fuzzy:!1,hideExpandedCounter:!0,highlight:!0,mode:"dimm"},init:function(event,data){let filter;new Filter("tab-duty",data.tree,lng_id).attachEvents(),smartScroll.is(":checked")&&data.tree.$container.addClass("smart-scroll"),data.tree.$div.contextmenu({delegate:"span.fancytree-title",menu:contextmenu[lng_id],beforeOpen:function(event,ui){let node=$.ui.fancytree.getNode(ui.target);data.tree.$div.contextmenu("enableEntry","remove",node.permission(["duty"])),data.tree.$div.contextmenu("enableEntry","rename",node.permission(["group","attribute","duty"])),data.tree.$div.contextmenu("enableEntry","addSibling",!1),data.tree.$div.contextmenu("enableEntry","addChild",!1),node.setActive()},select:function(event,ui){let command;new ContextmenuCommandDuty(ui).execute()}})}})}),ATTRIBUTE_PRODUCT_TREE.each(function(indx,element){var currentTab="tab-products",lng_id=parseInt(element.id.replace(/\D+/gi,"")),attribute_product_tree=$("#attribute_product_tree"+lng_id),sortOrder=$('input[id = "sortOrder_attribute_product_tree'+lng_id+'"]:checkbox').is(":checked"),lazyLoad=$('input[id = "lazyLoad_duty_attribute_tree'+lng_id+'"]:checkbox').is(":checked");attribute_product_tree.fancytree({autoCollapse:!0,autoScroll:!0,minExpandLevel:2,extensions:["filter"],selectMode:2,checkbox:!1,quicksearch:!0,source:{data:{user_token:user_token,token:token,language_id:lng_id,sortOrder:sortOrder,lazyLoad:lazyLoad,isPending:!1,tree:"5"},url:"index.php?route="+extension+"module/attributico/getAttributeGroupTree"},loadError:function(e,data){var error=data.error;error.status&&error.statusText?(data.message="Ajax error: "+data.message,data.details="Ajax error: "+error.statusText+", status code = "+error.status):(data.message="Custom error: "+data.message,data.details="An error occurred during loading: "+error),console.log(data),console.log(error.responseText)},beforeActivate:function(event,data){if(4===data.node.getLevel())return!1},activate:function(event,data){var tree;$("#product_tree"+lng_id).fancytree("getTree").reload({data:{user_token:user_token,token:token,language_id:lng_id,attribute_id:data.node.key,title:data.node.title,sortOrder:sortOrder,invert:$('input[id = "diver_product_tree'+lng_id+'"]:checkbox').is(":checked")},url:"index.php?route="+extension+"module/attributico/getProductTree"})},lazyLoad:function(event,data){data.result={data:{user_token:user_token,token:token,key:data.node.key,language_id:lng_id},url:"index.php?route="+extension+"module/attributico/getLazyAttributeValues"}},beforeSelect:function(event,data){if(!selectControl(data))return!1},select:function(event,data){selNodes=data.tree.getSelectedNodes()},click:function(event,data){},keydown:function(e,data){let command=new KeydownCommand(e,data);command.permissions={remove:!1,addChild:!1,addSibling:!1,copy:!1,paste:!1},command.execute()},filter:{autoApply:!0,counter:!0,fuzzy:!1,hideExpandedCounter:!0,highlight:!0,mode:"dimm"},init:function(event,data){let filter;new Filter(currentTab,data.tree,lng_id).attachEvents(),smartScroll.is(":checked")&&data.tree.$container.addClass("smart-scroll"),data.tree.$div.contextmenu({delegate:"span.fancytree-title",menu:contextmenu[lng_id],beforeOpen:function(event,ui){let node=$.ui.fancytree.getNode(ui.target);data.tree.$div.contextmenu("enableEntry","remove",!1),data.tree.$div.contextmenu("enableEntry","rename",!1),data.tree.$div.contextmenu("enableEntry","addSibling",!1),data.tree.$div.contextmenu("enableEntry","addChild",!1),data.tree.$div.contextmenu("enableEntry","copy",!1),data.tree.$div.contextmenu("enableEntry","paste",!1),node.setActive()},select:function(event,ui){let command;new ContextmenuCommand(ui).execute()}})}})}),PRODUCT_TREE.each(function(indx,element){var lng_id=parseInt(element.id.replace(/\D+/gi,"")),product_tree=$("#product_tree"+lng_id),diver=$('input[id = "diver_product_tree'+lng_id+'"]:checkbox').is(":checked");product_tree.fancytree({autoCollapse:!0,autoScroll:!0,minExpandLevel:2,source:{data:{user_token:user_token,token:token,language_id:lng_id,invert:diver},url:"index.php?route="+extension+"module/attributico/getProductTree"},loadError:function(e,data){var error=data.error;error.status&&error.statusText?(data.message="Ajax error: "+data.message,data.details="Ajax error: "+error.statusText+", status code = "+error.status):(data.message="Custom error: "+data.message,data.details="An error occurred during loading: "+error),console.log(data),console.log(error.responseText)},dblclick:function(event,data){if(data.node.getLevel()<=2)return data.node.setExpanded(!data.node.isExpanded()),!1;var about_blank=$('input[id = "input-attributico_about_blank"]:checkbox').is(":checked"),attribute_product_tree,attribute_node=$("#attribute_product_tree"+lng_id).fancytree("getTree").getActiveNode();about_blank?($("#reload.alert-danger").show(),window.open("index.php?route=catalog/product/"+edit+"&user_token="+user_token+"&token="+token+"&product_id="+data.node.key.split("_")[1]+"&attribute_id="+attribute_node.key.split("_")[1],"_blank")):window.location.href="index.php?route=catalog/product/"+edit+"&user_token="+user_token+"&token="+token+"&product_id="+data.node.key.split("_")[1]+"&attribute_id="+attribute_node.key.split("_")[1]},click:function(event,data){},keydown:function(e,data){let command=new KeydownCommand(e,data);command.permissions={remove:!1,addChild:!1,addSibling:!1,copy:!1,paste:!1},command.execute()},focusTree:function(e,data){data.tree.$container.focus()},init:function(event,data){smartScroll.is(":checked")&&data.tree.$container.addClass("smart-scroll"),data.tree.$div.contextmenu({delegate:"span.fancytree-title",menu:contextmenu[lng_id],beforeOpen:function(event,ui){let node=$.ui.fancytree.getNode(ui.target);data.tree.$div.contextmenu("enableEntry","remove",!1),data.tree.$div.contextmenu("enableEntry","rename",!1),data.tree.$div.contextmenu("enableEntry","addSibling",!1),data.tree.$div.contextmenu("enableEntry","addChild",!1),data.tree.$div.contextmenu("enableEntry","copy",!1),data.tree.$div.contextmenu("enableEntry","paste",!1),node.setActive()},select:function(event,ui){let command;new ContextmenuCommand(ui).execute()}})}})})}function dutyUpgrade(){$.ajax({data:{user_token:user_token,token:token},url:"index.php?route="+extension+"module/attributico/dutyUpgrade",success:function(){location.reload()}})}function check_for_updates(){$.ajax({data:{user_token:user_token,token:token},url:"index.php?route="+extension+"module/attributico/check_for_updates",dataType:"json",success:function(check){$("#infoModal").modal("show"),check.errno?(console.log(check),$("#infoModal #modal-content").html(check.errmsg)):check.compare?($("#infoModal #modal-content").html(check.content.well),$("#infoModal #modal-content").append(check.content.copyright)):($("#infoModal #modal-content").html(check.content.news),$("#infoModal #modal-content").append(check.content.links),$("#infoModal #modal-content").append(check.content.copyright))}})}function apply(){$('[id ^= "tree"].settings').each(function(indx,element){$(element).fancytree("getTree").generateFormElements()}),$(".alert-success, #error_warning.alert-danger").hide(),$.post($("#form-attributico").attr("action"),$("#form-attributico").serialize(),function(html){var $success=$(html).find(".alert-success, #error_warning.alert-danger");if($success.length>0)$(".alert-before").before($success);else{var $href=$(html).find('[selected="selected"]').val();$.post($href,"",function(html){var $success=$(html).find(".alert-success, #error_warning.alert-danger");$success.length>0&&$(".alert-before").before($success)})}$('input[id ^= "multiSelect"]:checkbox').prop("checked",$('input[name = "attributico_multiselect"]:checkbox').is(":checked")),$('input[id ^= "sortOrder"]:checkbox').prop("checked",$('input[name = "attributico_sortorder"]:checkbox').is(":checked")),$('input[id ^= "lazyLoad"]:checkbox').prop("checked",$('input[name = "attributico_lazyload"]:checkbox').is(":checked")),CATEGORY_TREE.each(function(indx,element){var tree;$("#"+element.id).fancytree("getTree").options.selectMode=$('input[id ^= "multiSelect"]:checkbox').is(":checked")?3:2}),CATEGORY_CHECK_TREE.each(function(indx,element){var tree;$("#"+element.id).fancytree("getTree").options.selectMode=$('input[id ^= "multiSelect"]:checkbox').is(":checked")?3:2}),ATTRIBUTE_SYNCRO_TREES.each(function(indx,element){var tree=$("#"+element.id).fancytree("getTree");tree.options.source.data.sortOrder=$('input[id ^= "sortOrder"]:checkbox').is(":checked"),tree.options.source.data.lazyLoad=$('input[id ^= "lazyLoad"]:checkbox').is(":checked"),tree.options.source.data.category_id=currentCategory,tree.reload()})})}function tools(task){$('[id *= "tree"].options').each(function(indx,element){$(element).fancytree("getTree").generateFormElements(!0,!0,{filter:null,stopOnParents:!1})}),$.ajax({data:{user_token:user_token,token:token,task:task,options:$("#form-attributico").serialize()},url:"index.php?route="+extension+"module/attributico/tools",beforeSend:function(){$("#column-2 .loader-img").show(),$("#column-2 .alert-success").hide(),$("#column-2 .alert-warning").show()},success:function(json){reloadAttribute(),reactivateCategory(),$("#column-2 .loader-img").hide(),$("#column-2 .alert-warning").hide(),$("#column-2 .alert-success").show(),$("#column-2 .alert-success").html(json)}})}!function($){$.fn.dropmenu=function(option){return this.each(function(){this.timer=null,this.items=new Array,$div=$("<div />"),$ul=$("<ul class='drop-menu' />"),$menu=$ul,$.extend(this,option),$(this).attr("autocomplete","off"),$(this).on("focus",function(event){event.preventDefault(),this.request()}),$(this).on("blur",function(){setTimeout(function(object){object.hide()},200,this)}),$(this).on("keydown",function(event){switch(event.preventDefault(),event.keyCode){case 27:this.hide();break;default:this.request()}}),$(this).on("mousedown",function(event){event.preventDefault(),event.stopPropagation(),$(this).focus()}),this.click=function(event){event.preventDefault(),value=$(event.target).parent().attr("data-value"),value&&this.items[value]&&this.select(this.items[value])},this.show=function(){var pos=$(this).position();$(this).siblings("div").children($menu).css({top:pos.top+$(this).outerHeight(),left:pos.left}),$(this).siblings("div").children($menu).show()},this.hide=function(){$(this).siblings("div").children($menu).hide()},this.request=function(){clearTimeout(this.timer),this.timer=setTimeout(function(object){object.source($(object).val(),$.proxy(object.response,object))},200,this)},this.response=function(json){if(html="",json.length){for(i=0;i<json.length;i++)this.items[json[i].value]=json[i];for(i=0;i<json.length;i++)json[i].category||(html+='<li data-value="'+json[i].value+'"><a href="#">'+json[i].label+"</a></li>");var category=new Array;for(i=0;i<json.length;i++)json[i].category&&(category[json[i].category]||(category[json[i].category]=new Array,category[json[i].category].name=json[i].category,category[json[i].category].item=new Array),category[json[i].category].item.push(json[i]));for(i in category)for(html+='<li class="drop-header">'+category[i].name+"</li>",j=0;j<category[i].item.length;j++)html+='<li data-value="'+category[i].item[j].value+'"><a href="#">&nbsp;&nbsp;&nbsp;'+category[i].item[j].label+"</a></li>"}html?this.show():this.hide(),$(this).siblings("div").children($menu).html(html)},$(this).after($div),$menu.appendTo($div),$(this).siblings("div").children($menu).delegate("a","mousedown",$.proxy(this.click,this))})}}(window.jQuery),$(function(){$('[id ^= "tree"]').each(function(indx,element){$(element).fancytree({checkbox:!0,selectMode:2,source:{data:{user_token:user_token,token:token,tree:indx+1},url:"index.php?route="+extension+"module/attributico/getChildrenSettings"}})}),GROUP_CHECK_TREE.each(function(indx,element){var sortOrder=$('input[name = "attributico_sortorder"]:checkbox').is(":checked");$(element).fancytree({checkbox:!0,selectMode:3,autoScroll:!0,source:{data:{user_token:user_token,token:token,sortOrder:sortOrder,onlyGroup:!0,isPending:!1},url:"index.php?route="+extension+"module/attributico/getAttributeGroupTree"},init:function(event,data){smartScroll.is(":checked")&&data.tree.$container.addClass("smart-scroll")}})}),CATEGORY_CHECK_TREE.each(function(indx,element){var sortOrder=$('input[name = "attributico_sortorder"]:checkbox').is(":checked");$(element).fancytree({autoCollapse:!0,autoScroll:!0,minExpandLevel:2,checkbox:!0,selectMode:$('input[id = "input-attributico_multiselect"]:checkbox').is(":checked")?3:2,source:{data:{user_token:user_token,token:token,sortOrder:sortOrder},url:"index.php?route="+extension+"module/attributico/getCategoryTree"},init:function(event,data){smartScroll.is(":checked")&&data.tree.$container.addClass("smart-scroll")}})}),$("#form-attributico").submit(function(){$('[id ^= "tree"].settings').each(function(indx,element){$(element).fancytree("getTree").generateFormElements()})}),$('a[data-toggle="pill"]').on("shown.bs.tab",function(e){$("#column-2 .alert-success").hide(),$("#column-2 .task-complete").hide(),$("#column-2 .alert-info").show()}),$('[name = "attributico_product_text"]').each(function(indx,element){$('[name = "attributico_autoadd"]').is(":checked")||$(element).prop({disabled:!0,checked:!1})}),$('input[name = "attributico_autoadd"]:checkbox').change(function(e){flag=$(this).is(":checked"),$('[name = "attributico_product_text"]').each(function(indx,element){$(element).prop({disabled:!flag})})}),$('input[name = "attributico_smart_scroll"]:checkbox').change(function(e){$(this).is(":checked")?$('[id *= "tree"]:not(.settings) > ul.fancytree-container').addClass("smart-scroll"):$("ul.fancytree-container").removeClass("smart-scroll")}),$('input[name = "attributico_cache"]:checkbox').change(function(e){$.ajax({data:{user_token:user_token,token:token},url:"index.php?route="+extension+"module/attributico/cacheDelete",success:function(json){let size=CATEGORY_SYNCRO_TREES.size();CATEGORY_SYNCRO_TREES.each(function(indx,element){var tree=$("#"+element.id).fancytree("getTree");tree.options.source.data.cache=$('input[name = "attributico_cache"]:checkbox').is(":checked"),tree.reload().done(function(){tree.options.source.data.isPending=!1,indx+1==size&&reloadAttribute()})})}})}),$('input[name = "attributico_multistore"]:checkbox').change(function(e){$.ajax({data:{user_token:user_token,token:token},url:"index.php?route="+extension+"module/attributico/cacheDelete",success:function(json){let size=CATEGORY_SYNCRO_TREES.size();CATEGORY_SYNCRO_TREES.each(function(indx,element){var tree=$("#"+element.id).fancytree("getTree");tree.options.source.data.multistore=$('input[name = "attributico_multistore"]:checkbox').is(":checked"),tree.reload().done(function(){tree.options.source.data.isPending=!1,indx+1==size&&reloadAttribute()})})}})}),$('[id *= "options_"]').dialog({autoOpen:!1,resizable:!1,modal:!0,buttons:[{icons:{primary:"ui-icon-check"},class:"hawt-button",title:"Apply",click:function(){$(this).dialog("close")}}]}),$('input[id ^= "lazyLoad"]:checkbox').change(function(e){var id=$(this).attr("id"),tree=$("#"+id.replace("lazyLoad_","")).fancytree("getTree"),lazyLoad=$(this).is(":checked");tree.options.source.data.lazyLoad=lazyLoad,tree.reload()}),$('input[id ^= "sortOrder"]:checkbox').change(function(e){var id=$(this).attr("id"),tree=$("#"+id.replace("sortOrder_","")).fancytree("getTree"),sortOrder=$(this).is(":checked");tree.options.source.data.sortOrder=sortOrder,tree.options.source.data.category_id=currentCategory,tree.reload()}),$('input[id ^= "autoCollapse"]:checkbox').change(function(e){var id=$(this).attr("id"),flag=$(this).is(":checked");$("#"+id.replace("autoCollapse_","")).fancytree("getTree").options.autoCollapse=flag}),$('input[id ^= "multiSelect"]:checkbox').change(function(e){var id=$(this).attr("id"),tree;$("#"+id.replace("multiSelect_","")).fancytree("getTree").options.selectMode=$(this).is(":checked")?3:2}),$('input[id ^= "diver"]:checkbox').change(function(e){var id=$(this).attr("id"),lng_id=parseInt(id.replace(/\D+/gi,"")),tree;$("#attribute_product_tree"+lng_id).fancytree("getTree").reactivate()})});