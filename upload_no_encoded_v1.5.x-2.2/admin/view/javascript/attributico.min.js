$.ui.fancytree._FancytreeNodeClass.prototype.getParentByKey=function(a){a=null==a?null:""+a;var c=this;if(null!=a&&a!==this.key)for(;c.key.indexOf(a)&&!c.isRootNode();)c=c.getParent();return c.isRootNode()?null:c};$.ui.fancytree._FancytreeNodeClass.prototype.findUnselectedSibling=function(){for(var a=this.getNextSibling()||this.getPrevSibling()||this.getParent();a.isSelected()&&!a.isRootNode();)a=a.getPrevSibling()||a.getParent();return a};
function reactivateCategory(){var a=null;0!==arguments.length&&(a=arguments[0]);$category_tree.each(function(c,b){var d=$("#"+b.id).fancytree("getTree");(d=(a?d.getNodeByKey(a.key):null)||d.getActiveNode())&&void 0!==d&&(d.setActive(!1),d.setActive(!0))})}
function reloadAttribute(){if(0==arguments.length)$attribute_synchro_trees.each(function(a,c){var f=$("#"+c.id).fancytree("getTree");ClearFilter(f);f.reload().done(function(){f.options.source.data.isPending=!1})});else{var a=arguments[0],c=arguments[1];$attribute_synchro_trees.each(function(b,d){var f=$("#"+d.id).fancytree("getTree");if(f!==a.tree||c)ClearFilter(f),f.reload().done(function(){f.options.source.data.isPending=!1;var b=f.getNodeByKey(a.key);b&&void 0!==b&&b.setActive()})});c||a.setActive()}}
function ClearFilter(a,c,b){a.isFilterActive()&&(a.clearFilter(),3===arguments.length?($("input[name *= "+c+"_search"+b+"]").val(""),$("span[id *= "+c+"_matches"+b+"]").text("")):($('input[name *= "search"]').val(""),$('span[id *= "matches"]').text("")),$("[id ^=loadImg]").hide())}
function FilterSettingsChange(a){var c=$(this).attr("id"),b=$(this).is(":checked");switch(c){case a.data.tab+"_autoComplete"+a.data.lng_id:$("button#"+a.data.tab+"_btnSearch"+a.data.lng_id).attr("disabled",$(this).is(":checked"));break;case a.data.tab+"_hideMode"+a.data.lng_id:a.data.tree.options.filter.mode=b?"hide":"dimm";break;case a.data.tab+"_counter"+a.data.lng_id:case a.data.tab+"_fuzzy"+a.data.lng_id:case a.data.tab+"_hideExpandedCounter"+a.data.lng_id:case a.data.tab+"_highlight"+a.data.lng_id:a.data.tree.options.filter[c.replace(/\d/g,
"")]=b}a.data.tree.clearFilter();$("input[name="+a.data.tab+"_search"+a.data.lng_id+"]").trigger("keyup")}
function FilterSearch(a){var c=0,b={autoExpand:$("#"+a.data.tab+"_autoExpand"+a.data.lng_id).is(":checked"),leavesOnly:$("#"+a.data.tab+"_leavesOnly"+a.data.lng_id).is(":checked")},d=$("#"+a.data.tab+"_attributesOnly"+a.data.lng_id).is(":checked"),f=$(this).val();a&&a.which===$.ui.keyCode.ESCAPE||""===$.trim(f)?$("button#"+a.data.tab+"_btnResetSearch"+a.data.lng_id).click():($("#"+a.data.tab+"_autoComplete"+a.data.lng_id).is(":checked")&&(d||a.data.tree.options.source.data.isPending||(a.data.tree.visit(function(a){a.isLazy()&&
a.load(!0)}),a.data.tree.options.source.data.isPending=!0),setTimeout(function(){c=$("#"+a.data.tab+"_regex"+a.data.lng_id).is(":checked")?a.data.tree.filterNodes(function(a){return(new RegExp(f,"i")).test(a.title)},b):a.data.tree.filterNodes(f,b);$("span#"+a.data.tab+"_matches"+a.data.lng_id).text("("+c+")")},600)),$("button#"+a.data.tab+"_btnResetSearch"+a.data.lng_id).attr("disabled",!1),$("span#"+a.data.tab+"_matches"+a.data.lng_id).text("("+c+")"))}
function FilterButtonSearch(a){var c=0,b={autoExpand:$("#"+a.data.tab+"_autoExpand"+a.data.lng_id).is(":checked"),leavesOnly:$("#"+a.data.tab+"_leavesOnly"+a.data.lng_id).is(":checked")},d=$("#"+a.data.tab+"_attributesOnly"+a.data.lng_id).is(":checked"),f=$("input[name="+a.data.tab+"_search"+a.data.lng_id+"]").val();a&&a.which===$.ui.keyCode.ESCAPE||""===$.trim(f)?$("button#"+a.data.tab+"_btnResetSearch"+a.data.lng_id).click():(d||a.data.tree.options.source.data.isPending||(a.data.tree.visit(function(a){a.isLazy()&&
a.load(!0)}),a.data.tree.options.source.data.isPending=!0),setTimeout(function(){c=$("#"+a.data.tab+"_regex"+a.data.lng_id).is(":checked")?a.data.tree.filterNodes(function(a){return(new RegExp(f,"i")).test(a.title)},b):a.data.tree.filterNodes(f,b);$("span#"+a.data.tab+"_matches"+a.data.lng_id).text("("+c+")")},600),$("button#"+a.data.tab+"_btnResetSearch"+a.data.lng_id).attr("disabled",!1),$("span#"+a.data.tab+"_matches"+a.data.lng_id).text("("+c+")"))}
function getSelectedKeys(a){var c=[];a&&a.forEach(function(a){c.push(a.key)});return c}function getSelectedTitles(){var a=[];selNodes&&selNodes.forEach(function(c){a.push(c.title)});return a}function deSelectNodes(a){selNodes&&selNodes.forEach(function(a){a.setSelected(!1)});selNodes=null}function selectControl(a){if(a.node.isTopLevel())return a.node.setSelected(!1),!1;a.node.tree.visit(function(c){a.node.getLevel()!==c.getLevel()&&c.setSelected(!1)});return!0}
function addAttribute(a,c,b){var d=a;for(a="attribute"===c?2:1;d.getLevel()>a;)d=d.getParent();$.ajax({data:{user_token:user_token,token:token,key:d.key,name:"attribute"===c?textNewAttribute:textNewGroup},url:"index.php?route="+extension+"module/attributico/addAttribute",success:function(a){d.editCreateNode("child",{title:"attribute"===c?textNewAttribute[b]:textNewGroup[b],key:c+"_"+a,folder:"group"===c?!0:!1})}})}
function deleteAttribute(a){if(confirm(textConfirm)&&(2===a.getLevel()||3===a.getLevel())){var c=a.findUnselectedSibling();$.ajax({data:{user_token:user_token,token:token,keys:selNodes?getSelectedKeys(selNodes):[a.key]},url:"index.php?route="+extension+"module/attributico/deleteAttributes",success:function(){selNodes?$.each(selNodes,function(a,c){c.remove()}):a.remove();reloadAttribute(c,!1);selNodes=null}})}}
function copyAttributes(a){var c=a.getParentByKey("group")||a.getParentByKey("category");c.key.indexOf("group")+1&&$.ajax({data:{user_token:user_token,token:token,target:c.key,attributes:clipboardTitles},url:"index.php?route="+extension+"module/attributico/addAttributes",success:function(){reloadAttribute(a,!0)}});c.key.indexOf("category")+1&&$.ajax({data:{attributes:selNodes?getSelectedKeys(selNodes):[clipboardNodes[0][1].key],category_id:c.key,categories:selCategories?getSelectedKeys(selCategories):
[c.key]},url:"index.php?route="+extension+"module/attributico/addCategoryAttributes&user_token="+user_token+"&token="+token,type:"POST",success:function(){reactivateCategory(c)}})}
function deleteAttributesFromCategory(a,c){var b=a.getParent().key;$.ajax({data:{attributes:selNodes?getSelectedKeys(selNodes):[a.key],category_id:b,categories:selCategories?getSelectedKeys(selCategories):[b]},url:"index.php?route="+extension+"module/attributico/deleteAttributesFromCategory&user_token="+user_token+"&token="+token,type:"POST",success:function(){reactivateCategory(c);reloadAttribute(a,!0)}});selNodes=null}
function addAttributeToCategory(a,c,b){$.ajax({data:{attributes:selNodes?getSelectedKeys(selNodes):[c.otherNode.key],category_id:a.key,categories:selCategories?getSelectedKeys(selCategories):[a.key]},url:"index.php?route="+extension+"module/attributico/addCategoryAttributes&user_token="+user_token+"&token="+token,type:"POST"}).done(function(){b?deleteAttributesFromCategory(c.otherNode,a):(deSelectNodes(c.otherNode),c.otherNode.tree.visit(function(a){a.isLazy()&&a.load(!0)}),reactivateCategory(a),
reloadAttribute(c.otherNode,!1))})}var clipboardNodes=[],clipboardTitles=[],pasteMode=null;
function copyPaste(a,c){switch(a){case "cut":case "copy":pasteMode=a;selNodes?selNodes.forEach(function(a,c){clipboardNodes[c]=[];clipboardTitles[c]=[];$attribute_group_tree.each(function(f,h){var k=$("#"+h.id).fancytree("getTree"),e=parseInt(h.id.replace(/\D+/ig,""));clipboardNodes[c][e]=k.getNodeByKey(a.key);clipboardTitles[c][e]=k.getNodeByKey(a.key).title})}):(clipboardNodes[0]=[],clipboardTitles[0]=[],$attribute_group_tree.each(function(a,d){var f=$("#"+d.id).fancytree("getTree"),h=parseInt(d.id.replace(/\D+/ig,
""));clipboardNodes[0][h]=f.getNodeByKey(c.key);clipboardTitles[0][h]=f.getNodeByKey(c.key).title}));break;case "paste":if(0==clipboardNodes.length){alert("Clipoard is empty.");break}"cut"==pasteMode?(copyAttributes(c,clipboardTitles),clipboardNodes[indx].remove()):copyAttributes(c,clipboardTitles);clipboardNodes=[];clipboardTitles=[];pasteMode=null;break;default:alert("Unhandled clipboard action '"+a+"'")}}
function initTrees(){$attribute_group_tree.each(function(a,c){var b=parseInt(c.id.replace(/\D+/ig,"")),d=$("#attribute_group_tree"+b),f=$('input[id = "sortOrder_attribute_group_tree'+b+'"]:checkbox').is(":checked"),h=$('input[id = "lazyLoad_attribute_group_tree'+b+'"]:checkbox').is(":checked");d.fancytree({autoCollapse:!0,autoScroll:!0,minExpandLevel:2,extensions:["edit","dnd","filter"],selectMode:2,checkbox:!1,quicksearch:!0,source:{data:{user_token:user_token,token:token,language_id:b,sortOrder:f,
lazyLoad:h,tree:"1",isPending:!1},url:"index.php?route="+extension+"module/attributico/getAttributeGroupTree"},loadError:function(a,b){var e=b.error;e.status&&e.statusText?(b.message="Ajax error: "+b.message,b.details="Ajax error: "+e.statusText+", status code = "+e.status):(b.message="Custom error: "+b.message,b.details="An error occurred during loading: "+e);console.log(b);console.log(e.responseText)},lazyLoad:function(a,g){g.result={data:{user_token:user_token,token:token,key:g.node.key,language_id:b},
url:"index.php?route="+extension+"module/attributico/getLazyAttributeValues"}},edit:{triggerStart:["f2","shift+click","mac+enter"],inputCss:{minWidth:"18em"},beforeEdit:function(a,b){if(b.node.isRootNode()||1===b.node.getLevel()||4===b.node.getLevel())return!1},edit:function(a,b){},beforeClose:function(a,b){},save:function(a,g){var e=g.node.getParent();$.ajax({data:{user_token:user_token,token:token,key:g.node.key,name:g.input.val(),language_id:b,oldname:g.orgTitle},url:"index.php?route="+extension+
"module/attributico/editAttribute"}).done(function(a){g.node.key.indexOf("template")+1?g.node.parent.isLazy()?e.getNextSibling().load(!0).done(function(a){reloadAttribute(g.node,!1)}):reloadAttribute(g.node,!0):g.node.key.indexOf("value")+1?g.node.parent.isLazy()?e.getPrevSibling().load(!0).done(function(a){e.load(!0).done(function(a){(g.node.tree.getNodeByKey(g.node.key)||g.node.getPrevSibling()||g.node.getNextSibling()).setActive()})}).done(function(a){reloadAttribute(g.node,!1)}):reloadAttribute(g.node,
!0):reloadAttribute(g.node,!1);g.node.setTitle(a.acceptedTitle)}).fail(function(a){g.node.setTitle(g.orgTitle)}).always(function(){$(g.node.span).removeClass("pending")});return!0},close:function(a,b){b.save&&$(b.node.span).addClass("pending")}},dnd:{autoExpandMS:600,focusOnClick:!0,preventVoidMoves:!0,preventRecursiveMoves:!1,dragStart:function(a,b){return b.node.isRootNode()||3<b.node.getLevel()?!1:!0},dragEnter:function(a,b){var e=a.getLevel(),c=b.otherNode.getLevel(),d=b.otherNode;return 1===
e||e>c||a===d.parent||a.parent===d.parent&&!b.tree.options.source.data.sortOrder&&!b.originalEvent.ctrlKey?!1:e!==c||b.originalEvent.ctrlKey?["over"]:["before","after"]},dragDrop:function(a,b){var e=b.otherNode,c=a.getLevel(),d=e.getLevel(),k=!1,f=a.getParent()!==e.getParent(),h=b.originalEvent.ctrlKey&&c===d;if(!h||confirm(textConfirm))selNodes?$.each(selNodes,function(e,c){h?c.remove():(c.moveTo(a,b.hitMode),k=!0)}):h?e.remove():e.moveTo(a,b.hitMode),h?(url="index.php?route="+extension+"module/attributico/mergeAttributeGroup",
k=!0):f?(url="index.php?route="+extension+"module/attributico/replaceAttributeGroup",k=!1):url="index.php?route="+extension+"module/attributico/sortAttributeGroup",$.ajax({data:{user_token:user_token,token:token,subjects:selNodes?getSelectedKeys(selNodes):[e.key],group:a.getParent().key,target:a.key,direct:b.hitMode},url:url}).done(function(){reloadAttribute(e,k);deSelectNodes(e)})},draggable:{scroll:!0}},beforeSelect:function(a,b){if(!selectControl(b))return!1},select:function(a,b){selNodes=b.tree.getSelectedNodes()},
click:function(a,b){a.ctrlKey?b.node.toggleSelected():deSelectNodes(b.node)},keydown:function(a,g){var c=g.node;switch(a.which){case 68:a.altKey&&(console.log("Debug mode: "),$.ajax({data:{user_token:user_token,token:token},url:"index.php?route="+extension+"module/attributico/debugSwitch",success:function(a){console.log(a)}}));break;case 66:a.ctrlKey&&(c.tree.visit(function(a){a.setExpanded(e)}),e=!e);break;case 46:deleteAttribute(c);break;case 77:a.ctrlKey&&addAttribute(c,"group",b);break;case 81:a.ctrlKey&&
addAttribute(c,"attribute",b);break;case 67:if(a.ctrlKey)return copyPaste("copy",c),!1;break;case 86:if(a.ctrlKey)return copyPaste("paste",c),deSelectNodes(c),!1}},filter:{autoApply:!0,counter:!0,fuzzy:!1,hideExpandedCounter:!0,highlight:!0,mode:"dimm"}});var k=d.fancytree("getTree"),e=!0;$("input[name=tab-attribute_search"+b+"]").keyup({tree:k,tab:"tab-attribute",lng_id:b},FilterSearch).focus();$("button#tab-attribute_btnSearch"+b).click({tree:k,tab:"tab-attribute",lng_id:b},FilterButtonSearch);
$("div#tab-attribute_filter"+b+" input:checkbox").change({tree:k,tab:"tab-attribute",lng_id:b},FilterSettingsChange);$("button#tab-attribute_btnResetSearch"+b).click(function(a){ClearFilter(k,"tab-attribute",b)}).attr("disabled",!0);$("button#tab-attribute_btnSearch"+b).attr("disabled",$("input#tab-attribute_autoComplete"+b).is(":checked"));d.contextmenu({delegate:"span.fancytree-title",menu:contextmenu[b],beforeOpen:function(a,b){var e=$.ui.fancytree.getNode(b.target);d.contextmenu("enableEntry",
"copy",!e.key.indexOf("attribute"));d.contextmenu("enableEntry","paste",0!=clipboardNodes.length&&!e.getParent().isRootNode());e.setActive()},select:function(a,g){var c=$.ui.fancytree.getNode(g.target);switch(g.cmd){case "expande":k.visit(function(a){a.setExpanded(!0)});e=!e;break;case "collapse":k.visit(function(a){a.setExpanded(!1)});e=!e;break;case "options":$("#options_attribute_group_tree"+b).dialog("open");break;case "rename":c.editStart();break;case "remove":deleteAttribute(c);break;case "addChild":1!==
c.getLevel()&&addAttribute(c,"attribute",b);break;case "addSibling":addAttribute(c,"group",b);break;case "copy":copyPaste(g.cmd,c);break;case "paste":copyPaste(g.cmd,c);deSelectNodes(c);break;default:alert("Todo: appply action '"+g.cmd+"' to node "+c)}}})});$category_tree.each(function(a,c){var b=parseInt(c.id.replace(/\D+/ig,"")),d=$("#category_tree"+b),f=!0,h=$('input[id = "sortOrder_category_tree'+b+'"]:checkbox').is(":checked");d.fancytree({autoCollapse:!0,autoScroll:!0,minExpandLevel:2,extensions:["dnd"],
checkbox:!0,selectMode:$('input[id = "multiSelect_category_tree'+b+'"]:checkbox').is(":checked")?3:2,source:{data:{user_token:user_token,token:token,language_id:b,sortOrder:h},url:"index.php?route="+extension+"module/attributico/getCategoryTree"},activate:function(a,e){var c=$("#category_attribute_tree"+b).fancytree("getTree");currentCategory=e.node.key;c.reload({data:{user_token:user_token,token:token,language_id:b,category_id:currentCategory,sortOrder:$('input[id = "sortOrder_category_attribute_tree'+
b+'"]:checkbox').is(":checked"),tree:"4"},url:"index.php?route="+extension+"module/attributico/getCategoryAttributeTree"})},dnd:{autoExpandMS:400,focusOnClick:!1,preventVoidMoves:!0,preventRecursiveMoves:!0,dragStart:function(a,b){return!1},dragEnter:function(a,b){return b.otherNode.getParent().key===a.key?!1:!0},dragDrop:function(a,b){addAttributeToCategory(a,b,b.otherNode.tree.$div.context.id.indexOf("attribute_tree"))}},select:function(a,b){selCategories=b.tree.getSelectedNodes();b.tree.options.autoCollapse=
!1;b.node.setExpanded(!(b.node.expanded&&!selCategories.length))},keydown:function(a,b){var c=b.node;switch(a.which){case 66:a.ctrlKey&&(c.tree.visit(function(a){a.setExpanded(f)}),f=!f);break;case 86:if(a.ctrlKey)return copyPaste("paste",c),deSelectNodes(c),!1}},focusTree:function(a,b){b.tree.$container.focus()}});d.contextmenu({delegate:"span.fancytree-title",menu:contextmenu[b],beforeOpen:function(a,b){var c=$.ui.fancytree.getNode(b.target);d.contextmenu("enableEntry","remove",!1);d.contextmenu("enableEntry",
"rename",!1);d.contextmenu("enableEntry","addSibling",!1);d.contextmenu("enableEntry","addChild",!1);d.contextmenu("enableEntry","paste",0!=clipboardNodes.length&&!c.getParent().isRootNode());c.setActive()},select:function(a,c){var l=$.ui.fancytree.getNode(c.target);switch(c.cmd){case "expande":d.fancytree("getTree").visit(function(a){a.setExpanded(!0)});break;case "collapse":d.fancytree("getTree").visit(function(a){a.setExpanded(!1)});break;case "options":$("#options_category_tree"+b).dialog("open");
break;case "paste":copyPaste(c.cmd,l);deSelectNodes(l);break;default:alert("Todo: appply action '"+c.cmd+"' to node "+l)}}})});$category_attribute_tree.each(function(a,c){var b=parseInt(c.id.replace(/\D+/ig,"")),d=$("#category_attribute_tree"+b),f=!0,h=$('input[id = "sortOrder_category_attribute_tree'+b+'"]:checkbox').is(":checked");d.fancytree({autoCollapse:!0,autoScroll:!0,minExpandLevel:2,selectMode:2,extensions:["edit","dnd"],source:{data:{user_token:user_token,token:token,language_id:b,category_id:currentCategory,
sortOrder:h,tree:"4"},url:"index.php?route="+extension+"module/attributico/getCategoryAttributeTree"},loadError:function(a,b){var c=b.error;c.status&&c.statusText?(b.message="Ajax error: "+b.message,b.details="Ajax error: "+c.statusText+", status code = "+c.status):(b.message="Custom error: "+b.message,b.details="An error occurred during loading: "+c);console.log(b);console.log(c.responseText)},lazyLoad:function(a,c){c.result={data:{user_token:user_token,token:token,key:c.node.key,language_id:b},
url:"index.php?route="+extension+"module/attributico/getLazyAttributeValues"}},edit:{triggerStart:[],inputCss:{minWidth:"18em"},beforeEdit:function(a,b){if(!b.isNew)return!1},edit:function(a,c){c.input.dropmenu({source:function(a,c){$.ajax({data:{user_token:user_token,token:token,filter_name:encodeURIComponent(a),language_id:b},url:"index.php?route="+extension+"module/attributico/autocomplete",dataType:"json",success:function(a){c($.map(a,function(a){return{category:a.attribute_group,label:a.name,
value:a.attribute_id}}))}})},select:function(a){c.input.val(a.label);c.node.key="attribute_"+a.value}})},beforeClose:function(a,b){},save:function(a,b){$.ajax({data:{attributes:[b.node.key],category_id:b.node.getParent().key,categories:selCategories?getSelectedKeys(selCategories):[b.node.getParent().key]},url:"index.php?route="+extension+"module/attributico/addCategoryAttributes&user_token="+user_token+"&token="+token,type:"POST"}).done(function(){$(b.node.span).removeClass("pending");b.node.setTitle(b.node.title);
reactivateCategory(b.node.getParent())});return!0},close:function(a,b){b.save&&$(b.node.span).addClass("pending")}},dnd:{autoExpandMS:400,focusOnClick:!1,preventVoidMoves:!0,preventRecursiveMoves:!0,dragStart:function(a,b){return!0},dragEnter:function(a,b){return a.tree===b.otherNode.tree||2<a.getLevel()?!1:!0},dragDrop:function(a,b){addAttributeToCategory(a.getParent().isRootNode()?a:a.getParent(),b,!1)}},beforeSelect:function(a,b){if(!selectControl(b))return!1},select:function(a,b){selNodes=b.tree.getSelectedNodes()},
click:function(a,b){a.ctrlKey?b.node.toggleSelected():deSelectNodes(b.node)},keydown:function(a,b){var c=b.node;switch(a.which){case 66:a.ctrlKey&&(c.tree.visit(function(a){a.setExpanded(f)}),f=!f);break;case 46:if(!confirm(textConfirm))break;deleteAttributesFromCategory(c,c);break;case 81:a.ctrlKey&&c.tree.getRootNode().getFirstChild().editCreateNode("child");break;case 67:if(a.ctrlKey)return copyPaste("copy",c),!1;break;case 86:if(a.ctrlKey)return copyPaste("paste",c),deSelectNodes(c),!1}},focusTree:function(a,
b){b.tree.$container.focus()}});d.contextmenu({delegate:"span.fancytree-title",menu:contextmenu[b],beforeOpen:function(a,b){var c=$.ui.fancytree.getNode(b.target);d.contextmenu("enableEntry","remove",!c.key.indexOf("attribute"));d.contextmenu("enableEntry","rename",!1);d.contextmenu("enableEntry","addSibling",!1);d.contextmenu("enableEntry","copy",!c.key.indexOf("attribute"));d.contextmenu("enableEntry","paste",0!=clipboardNodes.length);c.setActive()},select:function(a,c){var l=$.ui.fancytree.getNode(c.target);
switch(c.cmd){case "expande":d.fancytree("getTree").visit(function(a){a.setExpanded(!0)});break;case "collapse":d.fancytree("getTree").visit(function(a){a.setExpanded(!1)});break;case "remove":if(!confirm(textConfirm))break;deleteAttributesFromCategory(l,l);break;case "addChild":l.tree.getRootNode().getFirstChild().editCreateNode("child");break;case "options":$("#options_category_attribute_tree"+b).dialog("open");break;case "copy":copyPaste(c.cmd,l);break;case "paste":copyPaste(c.cmd,l);deSelectNodes(l);
break;default:alert("Todo: appply action '"+c.cmd+"' to node "+l)}}})});$attribute_tree.each(function(a,c){var b=parseInt(c.id.replace(/\D+/ig,"")),d=$("#attribute_tree"+b),f=!0,h=$('input[id = "sortOrder_attribute_tree'+b+'"]:checkbox').is(":checked"),k=$('input[id = "lazyLoad_attribute_tree'+b+'"]:checkbox').is(":checked");d.fancytree({autoCollapse:!0,autoScroll:!0,minExpandLevel:2,extensions:["dnd","filter"],selectMode:2,checkbox:!1,quicksearch:!0,source:{data:{user_token:user_token,token:token,
language_id:b,sortOrder:h,lazyLoad:k,isPending:!1,tree:"3"},url:"index.php?route="+extension+"module/attributico/getAttributeGroupTree"},loadError:function(a,b){var c=b.error;c.status&&c.statusText?(b.message="Ajax error: "+b.message,b.details="Ajax error: "+c.statusText+", status code = "+c.status):(b.message="Custom error: "+b.message,b.details="An error occurred during loading: "+c);console.log(b);console.log(c.responseText)},lazyLoad:function(a,c){c.result={data:{user_token:user_token,token:token,
key:c.node.key,language_id:b},url:"index.php?route="+extension+"module/attributico/getLazyAttributeValues"}},dnd:{autoExpandMS:800,focusOnClick:!0,preventVoidMoves:!0,preventRecursiveMoves:!0,dragStart:function(a,b){return 3!==b.node.getLevel()?!1:!0},draggable:{revert:!0,cursorAt:{top:-5,left:-5},connectToFancytree:!0,appendTo:"body",scroll:!0}},beforeSelect:function(a,b){if(!selectControl(b))return!1},select:function(a,b){selNodes=b.tree.getSelectedNodes()},click:function(a,b){a.ctrlKey?b.node.toggleSelected():
deSelectNodes(b.node)},keydown:function(a,b){var c=b.node;switch(a.which){case 66:a.ctrlKey&&(c.tree.visit(function(a){a.setExpanded(f)}),f=!f);break;case 67:if(a.ctrlKey)return copyPaste("copy",c),!1}},filter:{autoApply:!0,counter:!0,fuzzy:!1,hideExpandedCounter:!0,highlight:!0,mode:"dimm"}});var e=d.fancytree("getTree");$("input[name=tab-category_search"+b+"]").keyup({tree:e,tab:"tab-category",lng_id:b},FilterSearch).focus();$("button#tab-category_btnSearch"+b).click({tree:e,tab:"tab-category",
lng_id:b},FilterButtonSearch);$("div#tab-category_filter"+b+" input:checkbox").change({tree:e,tab:"tab-category",lng_id:b},FilterSettingsChange);$("button#tab-category_btnResetSearch"+b).click(function(a){ClearFilter(e,"tab-category",b)}).attr("disabled",!0);$("button#tab-category_btnSearch"+b).attr("disabled",$("input#tab-category_autoComplete"+b).is(":checked"));d.contextmenu({delegate:"span.fancytree-title",menu:contextmenu[b],beforeOpen:function(a,b){var c=$.ui.fancytree.getNode(b.target);d.contextmenu("enableEntry",
"remove",!1);d.contextmenu("enableEntry","rename",!1);d.contextmenu("enableEntry","addSibling",!1);d.contextmenu("enableEntry","addChild",!1);d.contextmenu("enableEntry","copy",!c.key.indexOf("attribute"));c.setActive()},select:function(a,c){var e=$.ui.fancytree.getNode(c.target);switch(c.cmd){case "expande":d.fancytree("getTree").visit(function(a){a.setExpanded(!0)});break;case "collapse":d.fancytree("getTree").visit(function(a){a.setExpanded(!1)});break;case "options":$("#options_attribute_tree"+
b).dialog("open");break;case "copy":copyPaste(c.cmd,e);break;default:alert("Todo: appply action '"+c.cmd+"' to node "+e)}}})});$duty_attribute_tree.each(function(a,c){var b=parseInt(c.id.replace(/\D+/ig,"")),d=$("#duty_attribute_tree"+b),f=$('input[id = "sortOrder_duty_attribute_tree'+b+'"]:checkbox').is(":checked"),h=$('input[id = "lazyLoad_duty_attribute_tree'+b+'"]:checkbox').is(":checked");d.fancytree({autoCollapse:!0,autoScroll:!0,minExpandLevel:2,extensions:["edit","filter"],checkbox:!1,quicksearch:!0,
source:{data:{user_token:user_token,token:token,language_id:b,sortOrder:f,lazyLoad:h,isPending:!1,tree:"2"},url:"index.php?route="+extension+"module/attributico/getAttributeGroupTree"},loadError:function(a,b){var c=b.error;c.status&&c.statusText?(b.message="Ajax error: "+b.message,b.details="Ajax error: "+c.statusText+", status code = "+c.status):(b.message="Custom error: "+b.message,b.details="An error occurred during loading: "+c);console.log(b);console.log(c.responseText)},lazyLoad:function(a,
c){c.result={data:{user_token:user_token,token:token,key:c.node.key,language_id:b},url:"index.php?route="+extension+"module/attributico/getLazyAttributeValues"}},edit:{triggerStart:["f2","shift+click","mac+enter"],inputCss:{minWidth:"18em"},beforeEdit:function(a,b){if(b.node.isRootNode()||1===b.node.getLevel())return!1},save:function(a,c){var d=c.node.getParent();$.ajax({data:{user_token:user_token,token:token,key:c.node.key,name:c.input.val(),language_id:b,oldname:c.orgTitle},url:"index.php?route="+
extension+"module/attributico/editAttribute"}).done(function(a){c.node.key.indexOf("template")+1?d.getNextSibling().load(!0).done(function(a){reloadAttribute(c.node,!1)}):c.node.key.indexOf("value")+1?d.getPrevSibling().load(!0).done(function(a){d.load(!0).done(function(a){(c.node.tree.getNodeByKey(c.node.key)||c.node.getPrevSibling()||c.node.getNextSibling()).setActive()})}).done(function(a){reloadAttribute(c.node,!1)}):reloadAttribute(c.node,!1);c.node.setTitle(a.acceptedTitle)}).fail(function(a){c.node.setTitle(c.orgTitle)}).always(function(){$(c.node.span).removeClass("pending")});
return!0},close:function(a,b){b.save&&$(b.node.span).addClass("pending")}},beforeSelect:function(a,b){return!1},keydown:function(a,b){var c=b.node;switch(a.which){case 66:a.ctrlKey&&(c.tree.visit(function(a){a.setExpanded(e)}),e=!e)}},filter:{autoApply:!0,counter:!0,fuzzy:!1,hideExpandedCounter:!0,highlight:!0,mode:"dimm"}});var k=d.fancytree("getTree"),e=!0;$("input[name=tab-duty_search"+b+"]").keyup({tree:k,tab:"tab-duty",lng_id:b},FilterSearch).focus();$("button#tab-duty_btnSearch"+b).click({tree:k,
tab:"tab-duty",lng_id:b},FilterButtonSearch);$("div#tab-duty_filter"+b+" input:checkbox").change({tree:k,tab:"tab-duty",lng_id:b},FilterSettingsChange);$("button#tab-duty_btnResetSearch"+b).click(function(a){ClearFilter(k,"tab-duty",b)}).attr("disabled",!0);$("button#tab-duty_btnSearch"+b).attr("disabled",$("input#tab-duty_autoComplete"+b).is(":checked"));d.contextmenu({delegate:"span.fancytree-title",menu:contextmenu[b],beforeOpen:function(a,b){var c=$.ui.fancytree.getNode(b.target);d.contextmenu("enableEntry",
"remove",!1);d.contextmenu("enableEntry","addSibling",!1);d.contextmenu("enableEntry","addChild",!1);c.setActive()},select:function(a,c){var d=$.ui.fancytree.getNode(c.target);switch(c.cmd){case "expande":k.visit(function(a){a.setExpanded(!0)});e=!e;break;case "collapse":k.visit(function(a){a.setExpanded(!1)});e=!e;break;case "options":$("#options_duty_attribute_tree"+b).dialog("open");break;case "rename":d.editStart();break;default:alert("Todo: appply action '"+c.cmd+"' to node "+d)}}})});$attribute_product_tree.each(function(a,
c){var b=parseInt(c.id.replace(/\D+/ig,"")),d=$("#attribute_product_tree"+b),f=!0,h=$('input[id = "sortOrder_attribute_product_tree'+b+'"]:checkbox').is(":checked"),k=$('input[id = "lazyLoad_duty_attribute_tree'+b+'"]:checkbox').is(":checked");d.fancytree({autoCollapse:!0,autoScroll:!0,minExpandLevel:2,extensions:["filter"],selectMode:2,checkbox:!1,quicksearch:!0,source:{data:{user_token:user_token,token:token,language_id:b,sortOrder:h,lazyLoad:k,isPending:!1,tree:"5"},url:"index.php?route="+extension+
"module/attributico/getAttributeGroupTree"},loadError:function(a,b){var c=b.error;c.status&&c.statusText?(b.message="Ajax error: "+b.message,b.details="Ajax error: "+c.statusText+", status code = "+c.status):(b.message="Custom error: "+b.message,b.details="An error occurred during loading: "+c);console.log(b);console.log(c.responseText)},beforeActivate:function(a,b){},activate:function(a,c){var d=$("#product_tree"+b).fancytree("getTree");currentAttributeID=c.node.key;d.reload({data:{user_token:user_token,
token:token,language_id:b,attribute_id:currentAttributeID,title:c.node.title,sortOrder:h},url:"index.php?route="+extension+"module/attributico/getProductTree"})},lazyLoad:function(a,c){c.result={data:{user_token:user_token,token:token,key:c.node.key,language_id:b},url:"index.php?route="+extension+"module/attributico/getLazyAttributeValues"}},beforeSelect:function(a,b){if(!selectControl(b))return!1},select:function(a,b){selNodes=b.tree.getSelectedNodes()},click:function(a,b){},keydown:function(a,b){var c=
b.node;switch(a.which){case 66:a.ctrlKey&&(c.tree.visit(function(a){a.setExpanded(f)}),f=!f);break;case 67:if(a.ctrlKey)return copyPaste("copy",c),!1}},filter:{autoApply:!0,counter:!0,fuzzy:!1,hideExpandedCounter:!0,highlight:!0,mode:"dimm"}});var e=d.fancytree("getTree");$("input[name=tab-products_search"+b+"]").keyup({tree:e,tab:"tab-products",lng_id:b},FilterSearch).focus();$("button#tab-products_btnSearch"+b).click({tree:e,tab:"tab-products",lng_id:b},FilterButtonSearch);$("div#tab-products_filter"+
b+" input:checkbox").change({tree:e,tab:"tab-products",lng_id:b},FilterSettingsChange);$("button#tab-products_btnResetSearch"+b).click(function(a){ClearFilter(e,"tab-products",b)}).attr("disabled",!0);$("button#tab-products_btnSearch"+b).attr("disabled",$("input#tab-products_autoComplete"+b).is(":checked"));d.contextmenu({delegate:"span.fancytree-title",menu:contextmenu[b],beforeOpen:function(a,b){var c=$.ui.fancytree.getNode(b.target);d.contextmenu("enableEntry","remove",!1);d.contextmenu("enableEntry",
"rename",!1);d.contextmenu("enableEntry","addSibling",!1);d.contextmenu("enableEntry","addChild",!1);d.contextmenu("enableEntry","copy",!c.key.indexOf("attribute"));c.setActive()},select:function(a,c){var e=$.ui.fancytree.getNode(c.target);switch(c.cmd){case "expande":d.fancytree("getTree").visit(function(a){a.setExpanded(!0)});break;case "collapse":d.fancytree("getTree").visit(function(a){a.setExpanded(!1)});break;case "options":$("#options_attribute_product_tree"+b).dialog("open");break;case "copy":copyPaste(c.cmd,
e);break;default:alert("Todo: appply action '"+c.cmd+"' to node "+e)}}})});$product_tree.each(function(a,c){var b=parseInt(c.id.replace(/\D+/ig,"")),d=$("#product_tree"+b),f=!0,h=$('input[id = "sortOrder_product_tree'+b+'"]:checkbox').is(":checked");d.fancytree({autoCollapse:!0,autoScroll:!0,minExpandLevel:2,source:{data:{user_token:user_token,token:token,language_id:b,attribute_id:currentAttributeID,sortOrder:h},url:"index.php?route="+extension+"module/attributico/getProductTree"},loadError:function(a,
b){var c=b.error;c.status&&c.statusText?(b.message="Ajax error: "+b.message,b.details="Ajax error: "+c.statusText+", status code = "+c.status):(b.message="Custom error: "+b.message,b.details="An error occurred during loading: "+c);console.log(b);console.log(c.responseText)},dblclick:function(a,b){$('input[id = "input-attributico_about_blank"]:checkbox').is(":checked")?($("#reload.alert-danger").show(),window.open("index.php?route=catalog/product/"+edit+"&user_token="+user_token+"&token="+token+"&product_id="+
b.node.key.split("_")[1]+"&attribute_id="+currentAttributeID.split("_")[1],"_blank")):window.location.href="index.php?route=catalog/product/"+edit+"&user_token="+user_token+"&token="+token+"&product_id="+b.node.key.split("_")[1]+"&attribute_id="+currentAttributeID.split("_")[1]},click:function(a,b){},keydown:function(a,b){var c=b.node;switch(a.which){case 66:a.ctrlKey&&(c.tree.visit(function(a){a.setExpanded(f)}),f=!f)}},focusTree:function(a,b){b.tree.$container.focus()}});d.contextmenu({delegate:"span.fancytree-title",
menu:contextmenu[b],beforeOpen:function(a,b){var c=$.ui.fancytree.getNode(b.target);d.contextmenu("enableEntry","remove",!1);d.contextmenu("enableEntry","rename",!1);d.contextmenu("enableEntry","addSibling",!1);d.contextmenu("enableEntry","addChild",!1);d.contextmenu("enableEntry","copy",!1);d.contextmenu("enableEntry","paste",!1);c.setActive()},select:function(a,c){var f=$.ui.fancytree.getNode(c.target);switch(c.cmd){case "expande":d.fancytree("getTree").visit(function(a){a.setExpanded(!0)});break;
case "collapse":d.fancytree("getTree").visit(function(a){a.setExpanded(!1)});break;case "options":$("#options_product_tree"+b).dialog("open");break;default:alert("Todo: appply action '"+c.cmd+"' to node "+f)}}})})}
(function(a){a.fn.dropmenu=function(c){return this.each(function(){this.timer=null;this.items=[];$div=a("<div />");$menu=$ul=a("<ul class='drop-menu' />");a.extend(this,c);a(this).attr("autocomplete","off");a(this).on("focus",function(a){a.preventDefault();this.request()});a(this).on("blur",function(){setTimeout(function(a){a.hide()},200,this)});a(this).on("keydown",function(a){a.preventDefault();switch(a.keyCode){case 27:this.hide();break;default:this.request()}});a(this).on("mousedown",function(b){b.preventDefault();
b.stopPropagation();a(this).focus()});this.click=function(b){b.preventDefault();(value=a(b.target).parent().attr("data-value"))&&this.items[value]&&this.select(this.items[value])};this.show=function(){var b=a(this).position();a(this).siblings("div").children($menu).css({top:b.top+a(this).outerHeight(),left:b.left});a(this).siblings("div").children($menu).show()};this.hide=function(){a(this).siblings("div").children($menu).hide()};this.request=function(){clearTimeout(this.timer);this.timer=setTimeout(function(b){b.source(a(b).val(),
a.proxy(b.response,b))},200,this)};this.response=function(b){html="";if(b.length){for(i=0;i<b.length;i++)this.items[b[i].value]=b[i];for(i=0;i<b.length;i++)b[i].category||(html+='<li data-value="'+b[i].value+'"><a href="#">'+b[i].label+"</a></li>");var c=[];for(i=0;i<b.length;i++)b[i].category&&(c[b[i].category]||(c[b[i].category]=[],c[b[i].category].name=b[i].category,c[b[i].category].item=[]),c[b[i].category].item.push(b[i]));for(i in c)for(html+='<li class="drop-header">'+c[i].name+"</li>",j=0;j<
c[i].item.length;j++)html+='<li data-value="'+c[i].item[j].value+'"><a href="#">&nbsp;&nbsp;&nbsp;'+c[i].item[j].label+"</a></li>"}html?this.show():this.hide();a(this).siblings("div").children($menu).html(html)};a(this).after($div);$menu.appendTo($div);a(this).siblings("div").children($menu).delegate("a","mousedown",a.proxy(this.click,this))})}})(window.jQuery);
function dutyUpgrade(){$.ajax({data:{user_token:user_token,token:token},url:"index.php?route="+extension+"module/attributico/dutyUpgrade",success:function(){location.reload()}})}
function apply(){$('[id ^= "tree"].settings').each(function(a,c){$(c).fancytree("getTree").generateFormElements()});$(".alert-success, #error_warning.alert-danger").hide();$.post($("#form-attributico").attr("action"),$("#form-attributico").serialize(),function(a){var c=$(a).find(".alert-success, #error_warning.alert-danger");0<c.length?$(".alert-before").before(c):(a=$(a).find('[selected="selected"]').val(),$.post(a,"",function(a){a=$(a).find(".alert-success, #error_warning.alert-danger");0<a.length&&
$(".alert-before").before(a)}));$('input[id ^= "multiSelect"]:checkbox').prop("checked",$('input[name = "attributico_multiselect"]:checkbox').is(":checked"));$('input[id ^= "sortOrder"]:checkbox').prop("checked",$('input[name = "attributico_sortorder"]:checkbox').is(":checked"));$('input[id ^= "lazyLoad"]:checkbox').prop("checked",$('input[name = "attributico_lazyload"]:checkbox').is(":checked"));$category_tree.each(function(a,c){$("#"+c.id).fancytree("getTree").options.selectMode=$('input[id ^= "multiSelect"]:checkbox').is(":checked")?
3:2});$category_check_tree.each(function(a,c){$("#"+c.id).fancytree("getTree").options.selectMode=$('input[id ^= "multiSelect"]:checkbox').is(":checked")?3:2});$attribute_synchro_trees.each(function(a,c){var f=$("#"+c.id).fancytree("getTree");f.options.source.data.sortOrder=$('input[id ^= "sortOrder"]:checkbox').is(":checked");f.options.source.data.lazyLoad=$('input[id ^= "lazyLoad"]:checkbox').is(":checked");f.options.source.data.category_id=currentCategory;f.reload()})})}
function check_for_updates(){$.ajax({data:{user_token:user_token,token:token},url:"index.php?route="+extension+"module/attributico/check_for_updates",dataType:"json",success:function(a){$("#infoModal").modal("show");a.errno?(console.log(a),$("#infoModal #modal-content").html(a.errmsg)):(a.compare?$("#infoModal #modal-content").html(a.content.well):($("#infoModal #modal-content").html(a.content.news),$("#infoModal #modal-content").append(a.content.links)),$("#infoModal #modal-content").append(a.content.copyright))}})}
$(function(){$('[id ^= "tree"]').each(function(a,c){$(c).fancytree({checkbox:!0,selectMode:2,source:{data:{user_token:user_token,token:token,tree:a+1},url:"index.php?route="+extension+"module/attributico/getChildrenSettings"}})});$("#form-attributico").submit(function(){$('[id ^= "tree"].settings').each(function(a,c){$(c).fancytree("getTree").generateFormElements()})});$('a[data-toggle="pill"]').on("shown.bs.tab",function(a){$("#column-2 .alert-success").hide();$("#column-2 .task-complete").hide();
$("#column-2 .alert-info").show()});$("#vtabs2").bind("tabsselect",function(a,c){alert("select");$("#column-2 .alert-success").hide();$("#column-2 .task-complete").hide();$("#column-2 .alert-info").show()});$('[name = "attributico_product_text"]').each(function(a,c){$('[name = "attributico_autoadd"]').is(":checked")||$(c).prop({disabled:!0,checked:!1})});$('input[name = "attributico_autoadd"]:checkbox').change(function(a){flag=$(this).is(":checked");$('[name = "attributico_product_text"]').each(function(a,
b){$(b).prop({disabled:!flag})})});$('input[id ^= "lazyLoad"]:checkbox').change(function(a){a=$(this).attr("id");a=$("#"+a.replace("lazyLoad_","")).fancytree("getTree");var c=$(this).is(":checked");a.options.source.data.lazyLoad=c;a.reload()});$('input[id ^= "sortOrder"]:checkbox').change(function(a){a=$(this).attr("id");a=$("#"+a.replace("sortOrder_","")).fancytree("getTree");var c=$(this).is(":checked");a.options.source.data.sortOrder=c;a.options.source.data.category_id=currentCategory;a.reload()});
$('input[id ^= "autoCollapse"]:checkbox').change(function(a){a=$(this).attr("id");var c=$(this).is(":checked");$("#"+a.replace("autoCollapse_","")).fancytree("getTree").options.autoCollapse=c});$('input[id ^= "multiSelect"]:checkbox').change(function(a){a=$(this).attr("id");$("#"+a.replace("multiSelect_","")).fancytree("getTree").options.selectMode=$(this).is(":checked")?3:2});$group_check_tree.each(function(a,c){var b=$('input[name = "attributico_sortorder"]:checkbox').is(":checked");$(c).fancytree({checkbox:!0,
selectMode:3,autoScroll:!0,source:{data:{user_token:user_token,token:token,sortOrder:b,onlyGroup:!0,isPending:!1},url:"index.php?route="+extension+"module/attributico/getAttributeGroupTree"}})});$category_check_tree.each(function(a,c){var b=$('input[name = "attributico_sortorder"]:checkbox').is(":checked");$(c).fancytree({autoCollapse:!0,autoScroll:!0,minExpandLevel:2,checkbox:!0,selectMode:$('input[id = "input-attributico_multiselect"]:checkbox').is(":checked")?3:2,source:{data:{user_token:user_token,
token:token,sortOrder:b},url:"index.php?route="+extension+"module/attributico/getCategoryTree"}})})});
function FilterAction(a,c,b){$("span#"+b+"_searchmode"+c+" input#"+b+"_regex"+c+":checkbox").prop({checked:!0});switch($(a).attr("id")){case "f_"+b+"_empty":$("input[name="+b+"_search"+c+"]").val("^s*$");$("button#"+b+"_btnSearch"+c).trigger("click");break;case "f_"+b+"_digital":$("input[name="+b+"_search"+c+"]").val("[0-9]");$("button#"+b+"_btnSearch"+c).trigger("click");break;case "f_"+b+"_html":$("input[name="+b+"_search"+c+"]").val("<[^>]+>");$("button#"+b+"_btnSearch"+c).trigger("click");break;
case "f_"+b+"_default":$("span#"+b+"_searchmode"+c+" input#"+b+"_regex"+c+":checkbox").prop({checked:!1}),$("button#"+b+"_btnResetSearch"+c).trigger("click")}return!1}
function tools(a){$('[id *= "tree"].options').each(function(a,b){$(b).fancytree("getTree").generateFormElements(!0,!0,{filter:null,stopOnParents:!1})});$.ajax({data:{user_token:user_token,token:token,task:a,options:$("#form-attributico").serialize()},url:"index.php?route="+extension+"module/attributico/tools",beforeSend:function(){$("#column-2 .loader-img").show();$("#column-2 .alert-success").hide();$("#column-2 .alert-warning").show()},success:function(a){reloadAttribute();reactivateCategory();
$("#column-2 .loader-img").hide();$("#column-2 .alert-warning").hide();$("#column-2 .alert-success").show();$("#column-2 .alert-success").html(a)}})};
